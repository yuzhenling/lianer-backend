{"timestamp": "2025-05-16T02:11:28.823642", "level": "ERROR", "message": "Error in get_pitch_listen_single_exam: PitchService.generate_interval_exam_pitch() missing 4 required positional arguments: 'play_mode', 'fix_mode_enabled', 'fix_mode', and 'fix_mode_val'\nTraceback: Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/api/v1/piano_pitch_api.py\", line 389, in get_pitch_listen_interval_exam\n    exam = await pitch_service.generate_interval_exam(pitch_interval_setting)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 399, in generate_interval_exam\n    questions = self.generate_interval_exam_pitch(interval_ids, question_num)\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: PitchService.generate_interval_exam_pitch() missing 4 required positional arguments: 'play_mode', 'fix_mode_enabled', 'fix_mode', and 'fix_mode_val'\n", "module": "piano_pitch_api", "function": "get_pitch_listen_interval_exam", "line": 392}
{"timestamp": "2025-05-19T05:18:18.623210", "level": "ERROR", "message": "Error in pay_order for order 3: OrderService.create_wechat_payment() missing 1 required positional argument: 'current_user'\nTraceback: Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/api/v1/order_api.py\", line 135, in create_payment\n    payment_data = await order_service.create_wechat_payment(order, current_user)\n                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: OrderService.create_wechat_payment() missing 1 required positional argument: 'current_user'\n", "module": "order_api", "function": "create_payment", "line": 146}
{"timestamp": "2025-05-19T05:18:39.929906", "level": "ERROR", "message": "Error in pay_order for order 3: OrderService.create_wechat_payment() missing 1 required positional argument: 'current_user'\nTraceback: Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/api/v1/order_api.py\", line 135, in create_payment\n    payment_data = await order_service.create_wechat_payment(order, current_user)\n                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: OrderService.create_wechat_payment() missing 1 required positional argument: 'current_user'\n", "module": "order_api", "function": "create_payment", "line": 146}
{"timestamp": "2025-05-19T05:19:06.306649", "level": "ERROR", "message": "Failed to create WeChat payment: module 'passlib.crypto' has no attribute 'load_certificate'", "module": "order_service", "function": "create_wechat_payment", "line": 97, "exception": {"type": "AttributeError", "message": "module 'passlib.crypto' has no attribute 'load_certificate'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 78, in create_wechat_payment\n    serial_no = self.get_serial_no_from_cert(settings.WECHAT_PAY_CERT_PATH)\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 228, in get_serial_no_from_cert\n    cert = crypto.load_certificate(crypto.FILETYPE_PEM, cert_content)\n           ^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: module 'passlib.crypto' has no attribute 'load_certificate'"}}
{"timestamp": "2025-05-19T05:20:43.150236", "level": "ERROR", "message": "Failed to create WeChat payment: module 'passlib.crypto' has no attribute 'load_certificate'", "module": "order_service", "function": "create_wechat_payment", "line": 97, "exception": {"type": "AttributeError", "message": "module 'passlib.crypto' has no attribute 'load_certificate'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 78, in create_wechat_payment\n    serial_no = self.get_serial_no_from_cert(settings.WECHAT_PAY_CERT_PATH)\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 228, in get_serial_no_from_cert\n    cert = crypto.load_certificate(crypto.FILETYPE_PEM, cert_content)\n           ^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: module 'passlib.crypto' has no attribute 'load_certificate'"}}
{"timestamp": "2025-05-19T05:26:55.889303", "level": "ERROR", "message": "Failed to create WeChat payment: module 'passlib.crypto' has no attribute 'load_certificate'", "module": "order_service", "function": "create_wechat_payment", "line": 97, "exception": {"type": "AttributeError", "message": "module 'passlib.crypto' has no attribute 'load_certificate'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 78, in create_wechat_payment\n    serial_no = self.get_serial_no_from_cert(settings.WECHAT_PAY_CERT_PATH)\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 228, in get_serial_no_from_cert\n    cert = crypto.load_certificate(crypto.FILETYPE_PEM, cert_content)\n           ^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: module 'passlib.crypto' has no attribute 'load_certificate'"}}
{"timestamp": "2025-05-19T05:35:23.324464", "level": "ERROR", "message": "Failed to create WeChat payment: module 'passlib.crypto' has no attribute 'load_certificate'", "module": "order_service", "function": "create_wechat_payment", "line": 97, "exception": {"type": "AttributeError", "message": "module 'passlib.crypto' has no attribute 'load_certificate'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 78, in create_wechat_payment\n    serial_no = self.get_serial_no_from_cert(settings.WECHAT_PAY_CERT_PATH)\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 228, in get_serial_no_from_cert\n    cert = crypto.load_certificate(crypto.FILETYPE_PEM, cert_content)\n           ^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: module 'passlib.crypto' has no attribute 'load_certificate'"}}
{"timestamp": "2025-05-19T05:58:51.829270", "level": "ERROR", "message": "Failed to create WeChat payment: OrderService._get_wechat_pay_headers() missing 1 required positional argument: 'private_key_path'", "module": "order_service", "function": "create_wechat_payment", "line": 95, "exception": {"type": "TypeError", "message": "OrderService._get_wechat_pay_headers() missing 1 required positional argument: 'private_key_path'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 78, in create_wechat_payment\n    headers = self._get_wechat_pay_headers(method=\"POST\", url=url, body=data, mch_id=settings.WECHAT_MCH_ID, serial_no=settings.WECHAT_PAY_SERIAL_NO, private_key_path=settings.WECHAT_PAY_KEY_PATH)\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: OrderService._get_wechat_pay_headers() missing 1 required positional argument: 'private_key_path'"}}
{"timestamp": "2025-05-19T05:59:02.448180", "level": "ERROR", "message": "Failed to create WeChat payment: OrderService._get_wechat_pay_headers() missing 1 required positional argument: 'private_key_path'", "module": "order_service", "function": "create_wechat_payment", "line": 95, "exception": {"type": "TypeError", "message": "OrderService._get_wechat_pay_headers() missing 1 required positional argument: 'private_key_path'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 78, in create_wechat_payment\n    headers = self._get_wechat_pay_headers(method=\"POST\", url=url, body=data, mch_id=settings.WECHAT_MCH_ID, serial_no=settings.WECHAT_PAY_SERIAL_NO, private_key_path=settings.WECHAT_PAY_KEY_PATH)\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: OrderService._get_wechat_pay_headers() missing 1 required positional argument: 'private_key_path'"}}
{"timestamp": "2025-05-19T06:13:11.182513", "level": "ERROR", "message": "Failed to create WeChat payment: 'builtin_function_or_method' object has no attribute 'choice'", "module": "order_service", "function": "create_wechat_payment", "line": 96, "exception": {"type": "AttributeError", "message": "'builtin_function_or_method' object has no attribute 'choice'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 79, in create_wechat_payment\n    headers = self._get_wechat_pay_headers(method=\"POST\", url=url, body=data, mch_id=settings.WECHAT_MCH_ID, serial_no=settings.WECHAT_PAY_SERIAL_NO, private_key_path=settings.WECHAT_PAY_KEY_PATH)\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 148, in _get_wechat_pay_headers\n    authorization = self.generate_authorization(method, url, body, mch_id, serial_no, private_key_path)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 178, in generate_authorization\n    nonce_str = self.generate_nonce_str()\n                ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 193, in generate_nonce_str\n    return ''.join(random.choice(string.ascii_letters + string.digits) for _ in range(length))\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 193, in <genexpr>\n    return ''.join(random.choice(string.ascii_letters + string.digits) for _ in range(length))\n                   ^^^^^^^^^^^^^\nAttributeError: 'builtin_function_or_method' object has no attribute 'choice'"}}
{"timestamp": "2025-05-19T06:13:40.525896", "level": "ERROR", "message": "Failed to create WeChat payment: 'builtin_function_or_method' object has no attribute 'choice'", "module": "order_service", "function": "create_wechat_payment", "line": 96, "exception": {"type": "AttributeError", "message": "'builtin_function_or_method' object has no attribute 'choice'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 79, in create_wechat_payment\n    headers = self._get_wechat_pay_headers(method=\"POST\", url=url, body=data, mch_id=settings.WECHAT_MCH_ID, serial_no=settings.WECHAT_PAY_SERIAL_NO, private_key_path=settings.WECHAT_PAY_KEY_PATH)\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 148, in _get_wechat_pay_headers\n    authorization = self.generate_authorization(method, url, body, mch_id, serial_no, private_key_path)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 178, in generate_authorization\n    nonce_str = self.generate_nonce_str()\n                ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 193, in generate_nonce_str\n    return ''.join(random.choice(string.ascii_letters + string.digits) for _ in range(length))\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 193, in <genexpr>\n    return ''.join(random.choice(string.ascii_letters + string.digits) for _ in range(length))\n                   ^^^^^^^^^^^^^\nAttributeError: 'builtin_function_or_method' object has no attribute 'choice'"}}
{"timestamp": "2025-05-19T06:16:12.169363", "level": "ERROR", "message": "Failed to create WeChat payment: 'builtin_function_or_method' object has no attribute 'choice'", "module": "order_service", "function": "create_wechat_payment", "line": 96, "exception": {"type": "AttributeError", "message": "'builtin_function_or_method' object has no attribute 'choice'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 79, in create_wechat_payment\n    headers = self._get_wechat_pay_headers(method=\"POST\", url=url, body=data, mch_id=settings.WECHAT_MCH_ID, serial_no=settings.WECHAT_PAY_SERIAL_NO, private_key_path=settings.WECHAT_PAY_KEY_PATH)\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 148, in _get_wechat_pay_headers\n    authorization = self.generate_authorization(method, url, body, mch_id, serial_no, private_key_path)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 178, in generate_authorization\n    nonce_str = self.generate_nonce_str()\n                ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 193, in generate_nonce_str\n    return ''.join(random.choice(string.ascii_letters + string.digits) for _ in range(length))\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 193, in <genexpr>\n    return ''.join(random.choice(string.ascii_letters + string.digits) for _ in range(length))\n                   ^^^^^^^^^^^^^\nAttributeError: 'builtin_function_or_method' object has no attribute 'choice'"}}
{"timestamp": "2025-05-19T10:00:45.085871", "level": "ERROR", "message": "Failed to create WeChat payment: OrderService._get_wechat_pay_headers() missing 2 required positional arguments: 'timestamp' and 'nonce_str'", "module": "order_service", "function": "create_wechat_payment", "line": 110, "exception": {"type": "TypeError", "message": "OrderService._get_wechat_pay_headers() missing 2 required positional arguments: 'timestamp' and 'nonce_str'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 87, in create_wechat_payment\n    headers = self._get_wechat_pay_headers(method=\"POST\", url=url, body=body_str, mch_id=settings.WECHAT_MCH_ID, serial_no=settings.WECHAT_PAY_SERIAL_NO, private_key_path=settings.WECHAT_PAY_KEY_PATH)\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: OrderService._get_wechat_pay_headers() missing 2 required positional arguments: 'timestamp' and 'nonce_str'"}}
