{"timestamp": "2025-05-16T02:11:28.823642", "level": "ERROR", "message": "Error in get_pitch_listen_single_exam: PitchService.generate_interval_exam_pitch() missing 4 required positional arguments: 'play_mode', 'fix_mode_enabled', 'fix_mode', and 'fix_mode_val'\nTraceback: Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/api/v1/piano_pitch_api.py\", line 389, in get_pitch_listen_interval_exam\n    exam = await pitch_service.generate_interval_exam(pitch_interval_setting)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 399, in generate_interval_exam\n    questions = self.generate_interval_exam_pitch(interval_ids, question_num)\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: PitchService.generate_interval_exam_pitch() missing 4 required positional arguments: 'play_mode', 'fix_mode_enabled', 'fix_mode', and 'fix_mode_val'\n", "module": "piano_pitch_api", "function": "get_pitch_listen_interval_exam", "line": 392}
{"timestamp": "2025-05-19T05:18:18.623210", "level": "ERROR", "message": "Error in pay_order for order 3: OrderService.create_wechat_payment() missing 1 required positional argument: 'current_user'\nTraceback: Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/api/v1/order_api.py\", line 135, in create_payment\n    payment_data = await order_service.create_wechat_payment(order, current_user)\n                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: OrderService.create_wechat_payment() missing 1 required positional argument: 'current_user'\n", "module": "order_api", "function": "create_payment", "line": 146}
{"timestamp": "2025-05-19T05:18:39.929906", "level": "ERROR", "message": "Error in pay_order for order 3: OrderService.create_wechat_payment() missing 1 required positional argument: 'current_user'\nTraceback: Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/api/v1/order_api.py\", line 135, in create_payment\n    payment_data = await order_service.create_wechat_payment(order, current_user)\n                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: OrderService.create_wechat_payment() missing 1 required positional argument: 'current_user'\n", "module": "order_api", "function": "create_payment", "line": 146}
{"timestamp": "2025-05-19T05:19:06.306649", "level": "ERROR", "message": "Failed to create WeChat payment: module 'passlib.crypto' has no attribute 'load_certificate'", "module": "order_service", "function": "create_wechat_payment", "line": 97, "exception": {"type": "AttributeError", "message": "module 'passlib.crypto' has no attribute 'load_certificate'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 78, in create_wechat_payment\n    serial_no = self.get_serial_no_from_cert(settings.WECHAT_PAY_CERT_PATH)\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 228, in get_serial_no_from_cert\n    cert = crypto.load_certificate(crypto.FILETYPE_PEM, cert_content)\n           ^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: module 'passlib.crypto' has no attribute 'load_certificate'"}}
{"timestamp": "2025-05-19T05:20:43.150236", "level": "ERROR", "message": "Failed to create WeChat payment: module 'passlib.crypto' has no attribute 'load_certificate'", "module": "order_service", "function": "create_wechat_payment", "line": 97, "exception": {"type": "AttributeError", "message": "module 'passlib.crypto' has no attribute 'load_certificate'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 78, in create_wechat_payment\n    serial_no = self.get_serial_no_from_cert(settings.WECHAT_PAY_CERT_PATH)\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 228, in get_serial_no_from_cert\n    cert = crypto.load_certificate(crypto.FILETYPE_PEM, cert_content)\n           ^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: module 'passlib.crypto' has no attribute 'load_certificate'"}}
{"timestamp": "2025-05-19T05:26:55.889303", "level": "ERROR", "message": "Failed to create WeChat payment: module 'passlib.crypto' has no attribute 'load_certificate'", "module": "order_service", "function": "create_wechat_payment", "line": 97, "exception": {"type": "AttributeError", "message": "module 'passlib.crypto' has no attribute 'load_certificate'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 78, in create_wechat_payment\n    serial_no = self.get_serial_no_from_cert(settings.WECHAT_PAY_CERT_PATH)\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 228, in get_serial_no_from_cert\n    cert = crypto.load_certificate(crypto.FILETYPE_PEM, cert_content)\n           ^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: module 'passlib.crypto' has no attribute 'load_certificate'"}}
{"timestamp": "2025-05-19T05:35:23.324464", "level": "ERROR", "message": "Failed to create WeChat payment: module 'passlib.crypto' has no attribute 'load_certificate'", "module": "order_service", "function": "create_wechat_payment", "line": 97, "exception": {"type": "AttributeError", "message": "module 'passlib.crypto' has no attribute 'load_certificate'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 78, in create_wechat_payment\n    serial_no = self.get_serial_no_from_cert(settings.WECHAT_PAY_CERT_PATH)\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 228, in get_serial_no_from_cert\n    cert = crypto.load_certificate(crypto.FILETYPE_PEM, cert_content)\n           ^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: module 'passlib.crypto' has no attribute 'load_certificate'"}}
{"timestamp": "2025-05-19T05:58:51.829270", "level": "ERROR", "message": "Failed to create WeChat payment: OrderService._get_wechat_pay_headers() missing 1 required positional argument: 'private_key_path'", "module": "order_service", "function": "create_wechat_payment", "line": 95, "exception": {"type": "TypeError", "message": "OrderService._get_wechat_pay_headers() missing 1 required positional argument: 'private_key_path'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 78, in create_wechat_payment\n    headers = self._get_wechat_pay_headers(method=\"POST\", url=url, body=data, mch_id=settings.WECHAT_MCH_ID, serial_no=settings.WECHAT_PAY_SERIAL_NO, private_key_path=settings.WECHAT_PAY_KEY_PATH)\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: OrderService._get_wechat_pay_headers() missing 1 required positional argument: 'private_key_path'"}}
{"timestamp": "2025-05-19T05:59:02.448180", "level": "ERROR", "message": "Failed to create WeChat payment: OrderService._get_wechat_pay_headers() missing 1 required positional argument: 'private_key_path'", "module": "order_service", "function": "create_wechat_payment", "line": 95, "exception": {"type": "TypeError", "message": "OrderService._get_wechat_pay_headers() missing 1 required positional argument: 'private_key_path'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 78, in create_wechat_payment\n    headers = self._get_wechat_pay_headers(method=\"POST\", url=url, body=data, mch_id=settings.WECHAT_MCH_ID, serial_no=settings.WECHAT_PAY_SERIAL_NO, private_key_path=settings.WECHAT_PAY_KEY_PATH)\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: OrderService._get_wechat_pay_headers() missing 1 required positional argument: 'private_key_path'"}}
{"timestamp": "2025-05-19T06:13:11.182513", "level": "ERROR", "message": "Failed to create WeChat payment: 'builtin_function_or_method' object has no attribute 'choice'", "module": "order_service", "function": "create_wechat_payment", "line": 96, "exception": {"type": "AttributeError", "message": "'builtin_function_or_method' object has no attribute 'choice'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 79, in create_wechat_payment\n    headers = self._get_wechat_pay_headers(method=\"POST\", url=url, body=data, mch_id=settings.WECHAT_MCH_ID, serial_no=settings.WECHAT_PAY_SERIAL_NO, private_key_path=settings.WECHAT_PAY_KEY_PATH)\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 148, in _get_wechat_pay_headers\n    authorization = self.generate_authorization(method, url, body, mch_id, serial_no, private_key_path)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 178, in generate_authorization\n    nonce_str = self.generate_nonce_str()\n                ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 193, in generate_nonce_str\n    return ''.join(random.choice(string.ascii_letters + string.digits) for _ in range(length))\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 193, in <genexpr>\n    return ''.join(random.choice(string.ascii_letters + string.digits) for _ in range(length))\n                   ^^^^^^^^^^^^^\nAttributeError: 'builtin_function_or_method' object has no attribute 'choice'"}}
{"timestamp": "2025-05-19T06:13:40.525896", "level": "ERROR", "message": "Failed to create WeChat payment: 'builtin_function_or_method' object has no attribute 'choice'", "module": "order_service", "function": "create_wechat_payment", "line": 96, "exception": {"type": "AttributeError", "message": "'builtin_function_or_method' object has no attribute 'choice'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 79, in create_wechat_payment\n    headers = self._get_wechat_pay_headers(method=\"POST\", url=url, body=data, mch_id=settings.WECHAT_MCH_ID, serial_no=settings.WECHAT_PAY_SERIAL_NO, private_key_path=settings.WECHAT_PAY_KEY_PATH)\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 148, in _get_wechat_pay_headers\n    authorization = self.generate_authorization(method, url, body, mch_id, serial_no, private_key_path)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 178, in generate_authorization\n    nonce_str = self.generate_nonce_str()\n                ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 193, in generate_nonce_str\n    return ''.join(random.choice(string.ascii_letters + string.digits) for _ in range(length))\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 193, in <genexpr>\n    return ''.join(random.choice(string.ascii_letters + string.digits) for _ in range(length))\n                   ^^^^^^^^^^^^^\nAttributeError: 'builtin_function_or_method' object has no attribute 'choice'"}}
{"timestamp": "2025-05-19T06:16:12.169363", "level": "ERROR", "message": "Failed to create WeChat payment: 'builtin_function_or_method' object has no attribute 'choice'", "module": "order_service", "function": "create_wechat_payment", "line": 96, "exception": {"type": "AttributeError", "message": "'builtin_function_or_method' object has no attribute 'choice'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 79, in create_wechat_payment\n    headers = self._get_wechat_pay_headers(method=\"POST\", url=url, body=data, mch_id=settings.WECHAT_MCH_ID, serial_no=settings.WECHAT_PAY_SERIAL_NO, private_key_path=settings.WECHAT_PAY_KEY_PATH)\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 148, in _get_wechat_pay_headers\n    authorization = self.generate_authorization(method, url, body, mch_id, serial_no, private_key_path)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 178, in generate_authorization\n    nonce_str = self.generate_nonce_str()\n                ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 193, in generate_nonce_str\n    return ''.join(random.choice(string.ascii_letters + string.digits) for _ in range(length))\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 193, in <genexpr>\n    return ''.join(random.choice(string.ascii_letters + string.digits) for _ in range(length))\n                   ^^^^^^^^^^^^^\nAttributeError: 'builtin_function_or_method' object has no attribute 'choice'"}}
{"timestamp": "2025-05-19T10:00:45.085871", "level": "ERROR", "message": "Failed to create WeChat payment: OrderService._get_wechat_pay_headers() missing 2 required positional arguments: 'timestamp' and 'nonce_str'", "module": "order_service", "function": "create_wechat_payment", "line": 110, "exception": {"type": "TypeError", "message": "OrderService._get_wechat_pay_headers() missing 2 required positional arguments: 'timestamp' and 'nonce_str'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 87, in create_wechat_payment\n    headers = self._get_wechat_pay_headers(method=\"POST\", url=url, body=body_str, mch_id=settings.WECHAT_MCH_ID, serial_no=settings.WECHAT_PAY_SERIAL_NO, private_key_path=settings.WECHAT_PAY_KEY_PATH)\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: OrderService._get_wechat_pay_headers() missing 2 required positional arguments: 'timestamp' and 'nonce_str'"}}
{"timestamp": "2025-05-19T10:20:30.238259", "level": "ERROR", "message": "Error in pay_order for order 1: (psycopg2.errors.UndefinedColumn) column vip_order.prepay_id does not exist\nLINE 1: ...er_user_id, vip_order.vip_id AS vip_order_vip_id, vip_order....\n                                                             ^\n\n[SQL: SELECT vip_order.id AS vip_order_id, vip_order.trade_no AS vip_order_trade_no, vip_order.user_id AS vip_order_user_id, vip_order.vip_id AS vip_order_vip_id, vip_order.prepay_id AS vip_order_prepay_id, vip_order.is_paid AS vip_order_is_paid, vip_order.paid_date AS vip_order_paid_date, vip_order.paid_amount AS vip_order_paid_amount, vip_order.is_return AS vip_order_is_return, vip_order.return_date AS vip_order_return_date, vip_order.return_amount AS vip_order_return_amount, vip_order.created_at AS vip_order_created_at, vip_order.updated_at AS vip_order_updated_at \nFROM vip_order \nWHERE vip_order.id = %(id_1)s AND vip_order.user_id = %(user_id_1)s \n LIMIT %(param_1)s]\n[parameters: {'id_1': 1, 'user_id_1': 1, 'param_1': 1}]\n(Background on this error at: https://sqlalche.me/e/20/f405)\nTraceback: Traceback (most recent call last):\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1969, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 922, in do_execute\n    cursor.execute(statement, parameters)\npsycopg2.errors.UndefinedColumn: column vip_order.prepay_id does not exist\nLINE 1: ...er_user_id, vip_order.vip_id AS vip_order_vip_id, vip_order....\n                                                             ^\n\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/api/v1/order_api.py\", line 121, in create_payment\n    ).first()\n      ^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/query.py\", line 2748, in first\n    return self.limit(1)._iter().first()  # type: ignore\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/query.py\", line 2847, in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\n                                                  ^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2308, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2190, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1416, in execute\n    return meth(\n           ^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 516, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1639, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1848, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1988, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2343, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1969, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 922, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column vip_order.prepay_id does not exist\nLINE 1: ...er_user_id, vip_order.vip_id AS vip_order_vip_id, vip_order....\n                                                             ^\n\n[SQL: SELECT vip_order.id AS vip_order_id, vip_order.trade_no AS vip_order_trade_no, vip_order.user_id AS vip_order_user_id, vip_order.vip_id AS vip_order_vip_id, vip_order.prepay_id AS vip_order_prepay_id, vip_order.is_paid AS vip_order_is_paid, vip_order.paid_date AS vip_order_paid_date, vip_order.paid_amount AS vip_order_paid_amount, vip_order.is_return AS vip_order_is_return, vip_order.return_date AS vip_order_return_date, vip_order.return_amount AS vip_order_return_amount, vip_order.created_at AS vip_order_created_at, vip_order.updated_at AS vip_order_updated_at \nFROM vip_order \nWHERE vip_order.id = %(id_1)s AND vip_order.user_id = %(user_id_1)s \n LIMIT %(param_1)s]\n[parameters: {'id_1': 1, 'user_id_1': 1, 'param_1': 1}]\n(Background on this error at: https://sqlalche.me/e/20/f405)\n", "module": "order_api", "function": "create_payment", "line": 147}
{"timestamp": "2025-05-21T11:54:16.623375", "level": "ERROR", "message": "Failed to initialize VIP levels", "module": "init_data", "function": "init_vip_levels", "line": 63, "exception": {"type": "AttributeError", "message": "'async_generator' object has no attribute 'query'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/db/init_data.py\", line 17, in init_vip_levels\n    existing_levels = await db.query(Vip).all()\n                            ^^^^^^^^\nAttributeError: 'async_generator' object has no attribute 'query'"}}
{"timestamp": "2025-05-21T11:54:16.624165", "level": "ERROR", "message": "Failed to initialize application", "module": "main", "function": "lifespan", "line": 66, "exception": {"type": "AttributeError", "message": "'async_generator' object has no attribute 'close'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/db/init_data.py\", line 17, in init_vip_levels\n    existing_levels = await db.query(Vip).all()\n                            ^^^^^^^^\nAttributeError: 'async_generator' object has no attribute 'query'\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/main.py\", line 41, in lifespan\n    await init_vip_levels(db)\n  File \"/home/yu/gitdev/shengyibaodian/app/db/init_data.py\", line 64, in init_vip_levels\n    await db.rollback()\n          ^^^^^^^^^^^\nAttributeError: 'async_generator' object has no attribute 'rollback'\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/main.py\", line 64, in lifespan\n    db.close()\n    ^^^^^^^^\nAttributeError: 'async_generator' object has no attribute 'close'"}}
{"timestamp": "2025-05-21T11:55:09.524340", "level": "ERROR", "message": "Failed to initialize VIP levels", "module": "init_data", "function": "init_vip_levels", "line": 63, "exception": {"type": "AttributeError", "message": "'async_generator' object has no attribute 'query'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/db/init_data.py\", line 17, in init_vip_levels\n    existing_levels = await db.query(Vip).all()\n                            ^^^^^^^^\nAttributeError: 'async_generator' object has no attribute 'query'"}}
{"timestamp": "2025-05-21T11:55:09.524974", "level": "ERROR", "message": "Failed to initialize application", "module": "main", "function": "lifespan", "line": 66, "exception": {"type": "AttributeError", "message": "'async_generator' object has no attribute 'rollback'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/db/init_data.py\", line 17, in init_vip_levels\n    existing_levels = await db.query(Vip).all()\n                            ^^^^^^^^\nAttributeError: 'async_generator' object has no attribute 'query'\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/main.py\", line 41, in lifespan\n    await init_vip_levels(db)\n  File \"/home/yu/gitdev/shengyibaodian/app/db/init_data.py\", line 64, in init_vip_levels\n    await db.rollback()\n          ^^^^^^^^^^^\nAttributeError: 'async_generator' object has no attribute 'rollback'"}}
{"timestamp": "2025-05-21T11:58:33.134088", "level": "ERROR", "message": "Failed to initialize application", "module": "main", "function": "lifespan", "line": 66, "exception": {"type": "TypeError", "message": "object async_generator can't be used in 'await' expression", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/main.py\", line 38, in lifespan\n    db = await get_db()\n         ^^^^^^^^^^^^^^\nTypeError: object async_generator can't be used in 'await' expression"}}
{"timestamp": "2025-05-21T11:59:09.155491", "level": "ERROR", "message": "Failed to initialize VIP levels", "module": "init_data", "function": "init_vip_levels", "line": 63, "exception": {"type": "AttributeError", "message": "'async_generator' object has no attribute 'query'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/db/init_data.py\", line 17, in init_vip_levels\n    existing_levels = await db.query(Vip).all()\n                            ^^^^^^^^\nAttributeError: 'async_generator' object has no attribute 'query'"}}
{"timestamp": "2025-05-21T11:59:09.156118", "level": "ERROR", "message": "Failed to initialize application", "module": "main", "function": "lifespan", "line": 66, "exception": {"type": "AttributeError", "message": "'async_generator' object has no attribute 'rollback'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/db/init_data.py\", line 17, in init_vip_levels\n    existing_levels = await db.query(Vip).all()\n                            ^^^^^^^^\nAttributeError: 'async_generator' object has no attribute 'query'\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/main.py\", line 41, in lifespan\n    await init_vip_levels(db)\n  File \"/home/yu/gitdev/shengyibaodian/app/db/init_data.py\", line 64, in init_vip_levels\n    await db.rollback()\n          ^^^^^^^^^^^\nAttributeError: 'async_generator' object has no attribute 'rollback'"}}
{"timestamp": "2025-05-21T12:01:47.481171", "level": "ERROR", "message": "Failed to initialize VIP levels", "module": "init_data", "function": "init_vip_levels", "line": 63, "exception": {"type": "AttributeError", "message": "'AsyncSession' object has no attribute 'query'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/db/init_data.py\", line 17, in init_vip_levels\n    existing_levels = await db.query(Vip).all()\n                            ^^^^^^^^\nAttributeError: 'AsyncSession' object has no attribute 'query'"}}
{"timestamp": "2025-05-21T12:01:47.481787", "level": "ERROR", "message": "Failed to initialize application", "module": "main", "function": "lifespan", "line": 67, "exception": {"type": "AttributeError", "message": "'AsyncSession' object has no attribute 'query'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/main.py\", line 42, in lifespan\n    await init_vip_levels(db)\n  File \"/home/yu/gitdev/shengyibaodian/app/db/init_data.py\", line 65, in init_vip_levels\n    raise e\n  File \"/home/yu/gitdev/shengyibaodian/app/db/init_data.py\", line 17, in init_vip_levels\n    existing_levels = await db.query(Vip).all()\n                            ^^^^^^^^\nAttributeError: 'AsyncSession' object has no attribute 'query'"}}
{"timestamp": "2025-05-21T13:04:47.443248", "level": "ERROR", "message": "Failed to build Pitch Interval cache", "module": "pitch_service", "function": "build_pitch_interval_cache", "line": 152, "exception": {"type": "KeyError", "message": "1", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 142, in build_pitch_interval_cache\n    type_name=self.PITCH_INTERVAL_TYPE_CACHE[pi.type_id].name,\n              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^\nKeyError: 1"}}
{"timestamp": "2025-05-21T13:04:47.444060", "level": "ERROR", "message": "Failed to initialize application", "module": "main", "function": "lifespan", "line": 67, "exception": {"type": "KeyError", "message": "1", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/main.py\", line 60, in lifespan\n    await pitch_service.build_pitch_interval_cache(db)\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 153, in build_pitch_interval_cache\n    raise e\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 142, in build_pitch_interval_cache\n    type_name=self.PITCH_INTERVAL_TYPE_CACHE[pi.type_id].name,\n              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^\nKeyError: 1"}}
{"timestamp": "2025-05-21T13:49:19.531877", "level": "ERROR", "message": "Failed to build Pitch Interval cache", "module": "pitch_service", "function": "build_pitch_interval_cache", "line": 152, "exception": {"type": "KeyError", "message": "1", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 142, in build_pitch_interval_cache\n    type_name=self.PITCH_INTERVAL_TYPE_CACHE[pi.type_id].name,\n              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^\nKeyError: 1"}}
{"timestamp": "2025-05-21T13:49:19.534063", "level": "ERROR", "message": "Failed to initialize application", "module": "main", "function": "lifespan", "line": 67, "exception": {"type": "KeyError", "message": "1", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/main.py\", line 60, in lifespan\n    await pitch_service.build_pitch_interval_cache(db)\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 153, in build_pitch_interval_cache\n    raise e\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 142, in build_pitch_interval_cache\n    type_name=self.PITCH_INTERVAL_TYPE_CACHE[pi.type_id].name,\n              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^\nKeyError: 1"}}
{"timestamp": "2025-05-21T13:49:49.662916", "level": "ERROR", "message": "Failed to build Pitch Interval cache", "module": "pitch_service", "function": "build_pitch_interval_cache", "line": 152, "exception": {"type": "KeyError", "message": "1", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 142, in build_pitch_interval_cache\n    type_name=self.PITCH_INTERVAL_TYPE_CACHE[pi.type_id].name,\n              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^\nKeyError: 1"}}
{"timestamp": "2025-05-21T13:50:11.652352", "level": "ERROR", "message": "Failed to initialize application", "module": "main", "function": "lifespan", "line": 67, "exception": {"type": "KeyError", "message": "1", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/main.py\", line 60, in lifespan\n    await pitch_service.build_pitch_interval_cache(db)\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 153, in build_pitch_interval_cache\n    raise e\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 142, in build_pitch_interval_cache\n    type_name=self.PITCH_INTERVAL_TYPE_CACHE[pi.type_id].name,\n              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^\nKeyError: 1"}}
{"timestamp": "2025-05-21T13:50:24.097391", "level": "ERROR", "message": "Failed to build Pitch Interval cache", "module": "pitch_service", "function": "build_pitch_interval_cache", "line": 152, "exception": {"type": "KeyError", "message": "1", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 142, in build_pitch_interval_cache\n    type_name=self.PITCH_INTERVAL_TYPE_CACHE[pi.type_id].name,\n              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^\nKeyError: 1"}}
{"timestamp": "2025-05-21T13:50:29.430442", "level": "ERROR", "message": "Failed to initialize application", "module": "main", "function": "lifespan", "line": 67, "exception": {"type": "KeyError", "message": "1", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/main.py\", line 60, in lifespan\n    await pitch_service.build_pitch_interval_cache(db)\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 153, in build_pitch_interval_cache\n    raise e\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 142, in build_pitch_interval_cache\n    type_name=self.PITCH_INTERVAL_TYPE_CACHE[pi.type_id].name,\n              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^\nKeyError: 1"}}
{"timestamp": "2025-05-21T13:51:10.194978", "level": "ERROR", "message": "Failed to build Pitch Interval cache", "module": "pitch_service", "function": "build_pitch_interval_cache", "line": 152, "exception": {"type": "KeyError", "message": "1", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 142, in build_pitch_interval_cache\n    type_name=self.PITCH_INTERVAL_TYPE_CACHE[pi.type_id].name,\n              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^\nKeyError: 1"}}
{"timestamp": "2025-05-22T13:39:30.525726", "level": "ERROR", "message": "Failed to update user info: 'AsyncSession' object has no attribute 'query'", "module": "auth_api", "function": "update_user_info", "line": 169, "exception": {"type": "AttributeError", "message": "'AsyncSession' object has no attribute 'query'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/api/v1/auth_api.py\", line 146, in update_user_info\n    existing_info = db.query(UserInfo).filter(UserInfo.user_id == current_user.id).first()\n                    ^^^^^^^^\nAttributeError: 'AsyncSession' object has no attribute 'query'"}}
{"timestamp": "2025-05-22T13:40:00.739870", "level": "ERROR", "message": "Failed to update user info: 'AsyncSession' object has no attribute 'query'", "module": "auth_api", "function": "update_user_info", "line": 169, "exception": {"type": "AttributeError", "message": "'AsyncSession' object has no attribute 'query'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/api/v1/auth_api.py\", line 146, in update_user_info\n    existing_info = db.query(UserInfo).filter(UserInfo.user_id == current_user.id).first()\n                    ^^^^^^^^\nAttributeError: 'AsyncSession' object has no attribute 'query'"}}
{"timestamp": "2025-05-22T13:41:34.988939", "level": "ERROR", "message": "Failed to update user info: type object 'UserInfo' has no attribute 'wechat_openid'", "module": "auth_api", "function": "update_user_info", "line": 170, "exception": {"type": "AttributeError", "message": "type object 'UserInfo' has no attribute 'wechat_openid'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/api/v1/auth_api.py\", line 147, in update_user_info\n    result = await db.execute(select(UserInfo).where(UserInfo.wechat_openid == current_user.id))\n                                                     ^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: type object 'UserInfo' has no attribute 'wechat_openid'"}}
