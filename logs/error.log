{"timestamp": "2025-05-16T02:11:28.823642", "level": "ERROR", "message": "Error in get_pitch_listen_single_exam: PitchService.generate_interval_exam_pitch() missing 4 required positional arguments: 'play_mode', 'fix_mode_enabled', 'fix_mode', and 'fix_mode_val'\nTraceback: Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/api/v1/piano_pitch_api.py\", line 389, in get_pitch_listen_interval_exam\n    exam = await pitch_service.generate_interval_exam(pitch_interval_setting)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 399, in generate_interval_exam\n    questions = self.generate_interval_exam_pitch(interval_ids, question_num)\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: PitchService.generate_interval_exam_pitch() missing 4 required positional arguments: 'play_mode', 'fix_mode_enabled', 'fix_mode', and 'fix_mode_val'\n", "module": "piano_pitch_api", "function": "get_pitch_listen_interval_exam", "line": 392}
{"timestamp": "2025-05-19T05:18:18.623210", "level": "ERROR", "message": "Error in pay_order for order 3: OrderService.create_wechat_payment() missing 1 required positional argument: 'current_user'\nTraceback: Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/api/v1/order_api.py\", line 135, in create_payment\n    payment_data = await order_service.create_wechat_payment(order, current_user)\n                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: OrderService.create_wechat_payment() missing 1 required positional argument: 'current_user'\n", "module": "order_api", "function": "create_payment", "line": 146}
{"timestamp": "2025-05-19T05:18:39.929906", "level": "ERROR", "message": "Error in pay_order for order 3: OrderService.create_wechat_payment() missing 1 required positional argument: 'current_user'\nTraceback: Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/api/v1/order_api.py\", line 135, in create_payment\n    payment_data = await order_service.create_wechat_payment(order, current_user)\n                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: OrderService.create_wechat_payment() missing 1 required positional argument: 'current_user'\n", "module": "order_api", "function": "create_payment", "line": 146}
{"timestamp": "2025-05-19T05:19:06.306649", "level": "ERROR", "message": "Failed to create WeChat payment: module 'passlib.crypto' has no attribute 'load_certificate'", "module": "order_service", "function": "create_wechat_payment", "line": 97, "exception": {"type": "AttributeError", "message": "module 'passlib.crypto' has no attribute 'load_certificate'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 78, in create_wechat_payment\n    serial_no = self.get_serial_no_from_cert(settings.WECHAT_PAY_CERT_PATH)\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 228, in get_serial_no_from_cert\n    cert = crypto.load_certificate(crypto.FILETYPE_PEM, cert_content)\n           ^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: module 'passlib.crypto' has no attribute 'load_certificate'"}}
{"timestamp": "2025-05-19T05:20:43.150236", "level": "ERROR", "message": "Failed to create WeChat payment: module 'passlib.crypto' has no attribute 'load_certificate'", "module": "order_service", "function": "create_wechat_payment", "line": 97, "exception": {"type": "AttributeError", "message": "module 'passlib.crypto' has no attribute 'load_certificate'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 78, in create_wechat_payment\n    serial_no = self.get_serial_no_from_cert(settings.WECHAT_PAY_CERT_PATH)\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 228, in get_serial_no_from_cert\n    cert = crypto.load_certificate(crypto.FILETYPE_PEM, cert_content)\n           ^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: module 'passlib.crypto' has no attribute 'load_certificate'"}}
{"timestamp": "2025-05-19T05:26:55.889303", "level": "ERROR", "message": "Failed to create WeChat payment: module 'passlib.crypto' has no attribute 'load_certificate'", "module": "order_service", "function": "create_wechat_payment", "line": 97, "exception": {"type": "AttributeError", "message": "module 'passlib.crypto' has no attribute 'load_certificate'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 78, in create_wechat_payment\n    serial_no = self.get_serial_no_from_cert(settings.WECHAT_PAY_CERT_PATH)\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 228, in get_serial_no_from_cert\n    cert = crypto.load_certificate(crypto.FILETYPE_PEM, cert_content)\n           ^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: module 'passlib.crypto' has no attribute 'load_certificate'"}}
{"timestamp": "2025-05-19T05:35:23.324464", "level": "ERROR", "message": "Failed to create WeChat payment: module 'passlib.crypto' has no attribute 'load_certificate'", "module": "order_service", "function": "create_wechat_payment", "line": 97, "exception": {"type": "AttributeError", "message": "module 'passlib.crypto' has no attribute 'load_certificate'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 78, in create_wechat_payment\n    serial_no = self.get_serial_no_from_cert(settings.WECHAT_PAY_CERT_PATH)\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 228, in get_serial_no_from_cert\n    cert = crypto.load_certificate(crypto.FILETYPE_PEM, cert_content)\n           ^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: module 'passlib.crypto' has no attribute 'load_certificate'"}}
{"timestamp": "2025-05-19T05:58:51.829270", "level": "ERROR", "message": "Failed to create WeChat payment: OrderService._get_wechat_pay_headers() missing 1 required positional argument: 'private_key_path'", "module": "order_service", "function": "create_wechat_payment", "line": 95, "exception": {"type": "TypeError", "message": "OrderService._get_wechat_pay_headers() missing 1 required positional argument: 'private_key_path'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 78, in create_wechat_payment\n    headers = self._get_wechat_pay_headers(method=\"POST\", url=url, body=data, mch_id=settings.WECHAT_MCH_ID, serial_no=settings.WECHAT_PAY_SERIAL_NO, private_key_path=settings.WECHAT_PAY_KEY_PATH)\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: OrderService._get_wechat_pay_headers() missing 1 required positional argument: 'private_key_path'"}}
{"timestamp": "2025-05-19T05:59:02.448180", "level": "ERROR", "message": "Failed to create WeChat payment: OrderService._get_wechat_pay_headers() missing 1 required positional argument: 'private_key_path'", "module": "order_service", "function": "create_wechat_payment", "line": 95, "exception": {"type": "TypeError", "message": "OrderService._get_wechat_pay_headers() missing 1 required positional argument: 'private_key_path'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 78, in create_wechat_payment\n    headers = self._get_wechat_pay_headers(method=\"POST\", url=url, body=data, mch_id=settings.WECHAT_MCH_ID, serial_no=settings.WECHAT_PAY_SERIAL_NO, private_key_path=settings.WECHAT_PAY_KEY_PATH)\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: OrderService._get_wechat_pay_headers() missing 1 required positional argument: 'private_key_path'"}}
{"timestamp": "2025-05-19T06:13:11.182513", "level": "ERROR", "message": "Failed to create WeChat payment: 'builtin_function_or_method' object has no attribute 'choice'", "module": "order_service", "function": "create_wechat_payment", "line": 96, "exception": {"type": "AttributeError", "message": "'builtin_function_or_method' object has no attribute 'choice'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 79, in create_wechat_payment\n    headers = self._get_wechat_pay_headers(method=\"POST\", url=url, body=data, mch_id=settings.WECHAT_MCH_ID, serial_no=settings.WECHAT_PAY_SERIAL_NO, private_key_path=settings.WECHAT_PAY_KEY_PATH)\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 148, in _get_wechat_pay_headers\n    authorization = self.generate_authorization(method, url, body, mch_id, serial_no, private_key_path)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 178, in generate_authorization\n    nonce_str = self.generate_nonce_str()\n                ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 193, in generate_nonce_str\n    return ''.join(random.choice(string.ascii_letters + string.digits) for _ in range(length))\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 193, in <genexpr>\n    return ''.join(random.choice(string.ascii_letters + string.digits) for _ in range(length))\n                   ^^^^^^^^^^^^^\nAttributeError: 'builtin_function_or_method' object has no attribute 'choice'"}}
{"timestamp": "2025-05-19T06:13:40.525896", "level": "ERROR", "message": "Failed to create WeChat payment: 'builtin_function_or_method' object has no attribute 'choice'", "module": "order_service", "function": "create_wechat_payment", "line": 96, "exception": {"type": "AttributeError", "message": "'builtin_function_or_method' object has no attribute 'choice'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 79, in create_wechat_payment\n    headers = self._get_wechat_pay_headers(method=\"POST\", url=url, body=data, mch_id=settings.WECHAT_MCH_ID, serial_no=settings.WECHAT_PAY_SERIAL_NO, private_key_path=settings.WECHAT_PAY_KEY_PATH)\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 148, in _get_wechat_pay_headers\n    authorization = self.generate_authorization(method, url, body, mch_id, serial_no, private_key_path)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 178, in generate_authorization\n    nonce_str = self.generate_nonce_str()\n                ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 193, in generate_nonce_str\n    return ''.join(random.choice(string.ascii_letters + string.digits) for _ in range(length))\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 193, in <genexpr>\n    return ''.join(random.choice(string.ascii_letters + string.digits) for _ in range(length))\n                   ^^^^^^^^^^^^^\nAttributeError: 'builtin_function_or_method' object has no attribute 'choice'"}}
{"timestamp": "2025-05-19T06:16:12.169363", "level": "ERROR", "message": "Failed to create WeChat payment: 'builtin_function_or_method' object has no attribute 'choice'", "module": "order_service", "function": "create_wechat_payment", "line": 96, "exception": {"type": "AttributeError", "message": "'builtin_function_or_method' object has no attribute 'choice'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 79, in create_wechat_payment\n    headers = self._get_wechat_pay_headers(method=\"POST\", url=url, body=data, mch_id=settings.WECHAT_MCH_ID, serial_no=settings.WECHAT_PAY_SERIAL_NO, private_key_path=settings.WECHAT_PAY_KEY_PATH)\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 148, in _get_wechat_pay_headers\n    authorization = self.generate_authorization(method, url, body, mch_id, serial_no, private_key_path)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 178, in generate_authorization\n    nonce_str = self.generate_nonce_str()\n                ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 193, in generate_nonce_str\n    return ''.join(random.choice(string.ascii_letters + string.digits) for _ in range(length))\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 193, in <genexpr>\n    return ''.join(random.choice(string.ascii_letters + string.digits) for _ in range(length))\n                   ^^^^^^^^^^^^^\nAttributeError: 'builtin_function_or_method' object has no attribute 'choice'"}}
{"timestamp": "2025-05-19T10:00:45.085871", "level": "ERROR", "message": "Failed to create WeChat payment: OrderService._get_wechat_pay_headers() missing 2 required positional arguments: 'timestamp' and 'nonce_str'", "module": "order_service", "function": "create_wechat_payment", "line": 110, "exception": {"type": "TypeError", "message": "OrderService._get_wechat_pay_headers() missing 2 required positional arguments: 'timestamp' and 'nonce_str'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 87, in create_wechat_payment\n    headers = self._get_wechat_pay_headers(method=\"POST\", url=url, body=body_str, mch_id=settings.WECHAT_MCH_ID, serial_no=settings.WECHAT_PAY_SERIAL_NO, private_key_path=settings.WECHAT_PAY_KEY_PATH)\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: OrderService._get_wechat_pay_headers() missing 2 required positional arguments: 'timestamp' and 'nonce_str'"}}
{"timestamp": "2025-05-19T10:20:30.238259", "level": "ERROR", "message": "Error in pay_order for order 1: (psycopg2.errors.UndefinedColumn) column vip_order.prepay_id does not exist\nLINE 1: ...er_user_id, vip_order.vip_id AS vip_order_vip_id, vip_order....\n                                                             ^\n\n[SQL: SELECT vip_order.id AS vip_order_id, vip_order.trade_no AS vip_order_trade_no, vip_order.user_id AS vip_order_user_id, vip_order.vip_id AS vip_order_vip_id, vip_order.prepay_id AS vip_order_prepay_id, vip_order.is_paid AS vip_order_is_paid, vip_order.paid_date AS vip_order_paid_date, vip_order.paid_amount AS vip_order_paid_amount, vip_order.is_return AS vip_order_is_return, vip_order.return_date AS vip_order_return_date, vip_order.return_amount AS vip_order_return_amount, vip_order.created_at AS vip_order_created_at, vip_order.updated_at AS vip_order_updated_at \nFROM vip_order \nWHERE vip_order.id = %(id_1)s AND vip_order.user_id = %(user_id_1)s \n LIMIT %(param_1)s]\n[parameters: {'id_1': 1, 'user_id_1': 1, 'param_1': 1}]\n(Background on this error at: https://sqlalche.me/e/20/f405)\nTraceback: Traceback (most recent call last):\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1969, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 922, in do_execute\n    cursor.execute(statement, parameters)\npsycopg2.errors.UndefinedColumn: column vip_order.prepay_id does not exist\nLINE 1: ...er_user_id, vip_order.vip_id AS vip_order_vip_id, vip_order....\n                                                             ^\n\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/api/v1/order_api.py\", line 121, in create_payment\n    ).first()\n      ^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/query.py\", line 2748, in first\n    return self.limit(1)._iter().first()  # type: ignore\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/query.py\", line 2847, in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\n                                                  ^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2308, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2190, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1416, in execute\n    return meth(\n           ^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 516, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1639, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1848, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1988, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2343, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1969, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 922, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column vip_order.prepay_id does not exist\nLINE 1: ...er_user_id, vip_order.vip_id AS vip_order_vip_id, vip_order....\n                                                             ^\n\n[SQL: SELECT vip_order.id AS vip_order_id, vip_order.trade_no AS vip_order_trade_no, vip_order.user_id AS vip_order_user_id, vip_order.vip_id AS vip_order_vip_id, vip_order.prepay_id AS vip_order_prepay_id, vip_order.is_paid AS vip_order_is_paid, vip_order.paid_date AS vip_order_paid_date, vip_order.paid_amount AS vip_order_paid_amount, vip_order.is_return AS vip_order_is_return, vip_order.return_date AS vip_order_return_date, vip_order.return_amount AS vip_order_return_amount, vip_order.created_at AS vip_order_created_at, vip_order.updated_at AS vip_order_updated_at \nFROM vip_order \nWHERE vip_order.id = %(id_1)s AND vip_order.user_id = %(user_id_1)s \n LIMIT %(param_1)s]\n[parameters: {'id_1': 1, 'user_id_1': 1, 'param_1': 1}]\n(Background on this error at: https://sqlalche.me/e/20/f405)\n", "module": "order_api", "function": "create_payment", "line": 147}
{"timestamp": "2025-05-21T11:54:16.623375", "level": "ERROR", "message": "Failed to initialize VIP levels", "module": "init_data", "function": "init_vip_levels", "line": 63, "exception": {"type": "AttributeError", "message": "'async_generator' object has no attribute 'query'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/db/init_data.py\", line 17, in init_vip_levels\n    existing_levels = await db.query(Vip).all()\n                            ^^^^^^^^\nAttributeError: 'async_generator' object has no attribute 'query'"}}
{"timestamp": "2025-05-21T11:54:16.624165", "level": "ERROR", "message": "Failed to initialize application", "module": "main", "function": "lifespan", "line": 66, "exception": {"type": "AttributeError", "message": "'async_generator' object has no attribute 'close'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/db/init_data.py\", line 17, in init_vip_levels\n    existing_levels = await db.query(Vip).all()\n                            ^^^^^^^^\nAttributeError: 'async_generator' object has no attribute 'query'\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/main.py\", line 41, in lifespan\n    await init_vip_levels(db)\n  File \"/home/yu/gitdev/shengyibaodian/app/db/init_data.py\", line 64, in init_vip_levels\n    await db.rollback()\n          ^^^^^^^^^^^\nAttributeError: 'async_generator' object has no attribute 'rollback'\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/main.py\", line 64, in lifespan\n    db.close()\n    ^^^^^^^^\nAttributeError: 'async_generator' object has no attribute 'close'"}}
{"timestamp": "2025-05-21T11:55:09.524340", "level": "ERROR", "message": "Failed to initialize VIP levels", "module": "init_data", "function": "init_vip_levels", "line": 63, "exception": {"type": "AttributeError", "message": "'async_generator' object has no attribute 'query'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/db/init_data.py\", line 17, in init_vip_levels\n    existing_levels = await db.query(Vip).all()\n                            ^^^^^^^^\nAttributeError: 'async_generator' object has no attribute 'query'"}}
{"timestamp": "2025-05-21T11:55:09.524974", "level": "ERROR", "message": "Failed to initialize application", "module": "main", "function": "lifespan", "line": 66, "exception": {"type": "AttributeError", "message": "'async_generator' object has no attribute 'rollback'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/db/init_data.py\", line 17, in init_vip_levels\n    existing_levels = await db.query(Vip).all()\n                            ^^^^^^^^\nAttributeError: 'async_generator' object has no attribute 'query'\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/main.py\", line 41, in lifespan\n    await init_vip_levels(db)\n  File \"/home/yu/gitdev/shengyibaodian/app/db/init_data.py\", line 64, in init_vip_levels\n    await db.rollback()\n          ^^^^^^^^^^^\nAttributeError: 'async_generator' object has no attribute 'rollback'"}}
{"timestamp": "2025-05-21T11:58:33.134088", "level": "ERROR", "message": "Failed to initialize application", "module": "main", "function": "lifespan", "line": 66, "exception": {"type": "TypeError", "message": "object async_generator can't be used in 'await' expression", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/main.py\", line 38, in lifespan\n    db = await get_db()\n         ^^^^^^^^^^^^^^\nTypeError: object async_generator can't be used in 'await' expression"}}
{"timestamp": "2025-05-21T11:59:09.155491", "level": "ERROR", "message": "Failed to initialize VIP levels", "module": "init_data", "function": "init_vip_levels", "line": 63, "exception": {"type": "AttributeError", "message": "'async_generator' object has no attribute 'query'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/db/init_data.py\", line 17, in init_vip_levels\n    existing_levels = await db.query(Vip).all()\n                            ^^^^^^^^\nAttributeError: 'async_generator' object has no attribute 'query'"}}
{"timestamp": "2025-05-21T11:59:09.156118", "level": "ERROR", "message": "Failed to initialize application", "module": "main", "function": "lifespan", "line": 66, "exception": {"type": "AttributeError", "message": "'async_generator' object has no attribute 'rollback'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/db/init_data.py\", line 17, in init_vip_levels\n    existing_levels = await db.query(Vip).all()\n                            ^^^^^^^^\nAttributeError: 'async_generator' object has no attribute 'query'\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/main.py\", line 41, in lifespan\n    await init_vip_levels(db)\n  File \"/home/yu/gitdev/shengyibaodian/app/db/init_data.py\", line 64, in init_vip_levels\n    await db.rollback()\n          ^^^^^^^^^^^\nAttributeError: 'async_generator' object has no attribute 'rollback'"}}
{"timestamp": "2025-05-21T12:01:47.481171", "level": "ERROR", "message": "Failed to initialize VIP levels", "module": "init_data", "function": "init_vip_levels", "line": 63, "exception": {"type": "AttributeError", "message": "'AsyncSession' object has no attribute 'query'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/db/init_data.py\", line 17, in init_vip_levels\n    existing_levels = await db.query(Vip).all()\n                            ^^^^^^^^\nAttributeError: 'AsyncSession' object has no attribute 'query'"}}
{"timestamp": "2025-05-21T12:01:47.481787", "level": "ERROR", "message": "Failed to initialize application", "module": "main", "function": "lifespan", "line": 67, "exception": {"type": "AttributeError", "message": "'AsyncSession' object has no attribute 'query'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/main.py\", line 42, in lifespan\n    await init_vip_levels(db)\n  File \"/home/yu/gitdev/shengyibaodian/app/db/init_data.py\", line 65, in init_vip_levels\n    raise e\n  File \"/home/yu/gitdev/shengyibaodian/app/db/init_data.py\", line 17, in init_vip_levels\n    existing_levels = await db.query(Vip).all()\n                            ^^^^^^^^\nAttributeError: 'AsyncSession' object has no attribute 'query'"}}
{"timestamp": "2025-05-21T13:04:47.443248", "level": "ERROR", "message": "Failed to build Pitch Interval cache", "module": "pitch_service", "function": "build_pitch_interval_cache", "line": 152, "exception": {"type": "KeyError", "message": "1", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 142, in build_pitch_interval_cache\n    type_name=self.PITCH_INTERVAL_TYPE_CACHE[pi.type_id].name,\n              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^\nKeyError: 1"}}
{"timestamp": "2025-05-21T13:04:47.444060", "level": "ERROR", "message": "Failed to initialize application", "module": "main", "function": "lifespan", "line": 67, "exception": {"type": "KeyError", "message": "1", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/main.py\", line 60, in lifespan\n    await pitch_service.build_pitch_interval_cache(db)\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 153, in build_pitch_interval_cache\n    raise e\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 142, in build_pitch_interval_cache\n    type_name=self.PITCH_INTERVAL_TYPE_CACHE[pi.type_id].name,\n              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^\nKeyError: 1"}}
{"timestamp": "2025-05-21T13:49:19.531877", "level": "ERROR", "message": "Failed to build Pitch Interval cache", "module": "pitch_service", "function": "build_pitch_interval_cache", "line": 152, "exception": {"type": "KeyError", "message": "1", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 142, in build_pitch_interval_cache\n    type_name=self.PITCH_INTERVAL_TYPE_CACHE[pi.type_id].name,\n              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^\nKeyError: 1"}}
{"timestamp": "2025-05-21T13:49:19.534063", "level": "ERROR", "message": "Failed to initialize application", "module": "main", "function": "lifespan", "line": 67, "exception": {"type": "KeyError", "message": "1", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/main.py\", line 60, in lifespan\n    await pitch_service.build_pitch_interval_cache(db)\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 153, in build_pitch_interval_cache\n    raise e\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 142, in build_pitch_interval_cache\n    type_name=self.PITCH_INTERVAL_TYPE_CACHE[pi.type_id].name,\n              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^\nKeyError: 1"}}
{"timestamp": "2025-05-21T13:49:49.662916", "level": "ERROR", "message": "Failed to build Pitch Interval cache", "module": "pitch_service", "function": "build_pitch_interval_cache", "line": 152, "exception": {"type": "KeyError", "message": "1", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 142, in build_pitch_interval_cache\n    type_name=self.PITCH_INTERVAL_TYPE_CACHE[pi.type_id].name,\n              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^\nKeyError: 1"}}
{"timestamp": "2025-05-21T13:50:11.652352", "level": "ERROR", "message": "Failed to initialize application", "module": "main", "function": "lifespan", "line": 67, "exception": {"type": "KeyError", "message": "1", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/main.py\", line 60, in lifespan\n    await pitch_service.build_pitch_interval_cache(db)\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 153, in build_pitch_interval_cache\n    raise e\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 142, in build_pitch_interval_cache\n    type_name=self.PITCH_INTERVAL_TYPE_CACHE[pi.type_id].name,\n              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^\nKeyError: 1"}}
{"timestamp": "2025-05-21T13:50:24.097391", "level": "ERROR", "message": "Failed to build Pitch Interval cache", "module": "pitch_service", "function": "build_pitch_interval_cache", "line": 152, "exception": {"type": "KeyError", "message": "1", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 142, in build_pitch_interval_cache\n    type_name=self.PITCH_INTERVAL_TYPE_CACHE[pi.type_id].name,\n              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^\nKeyError: 1"}}
{"timestamp": "2025-05-21T13:50:29.430442", "level": "ERROR", "message": "Failed to initialize application", "module": "main", "function": "lifespan", "line": 67, "exception": {"type": "KeyError", "message": "1", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/main.py\", line 60, in lifespan\n    await pitch_service.build_pitch_interval_cache(db)\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 153, in build_pitch_interval_cache\n    raise e\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 142, in build_pitch_interval_cache\n    type_name=self.PITCH_INTERVAL_TYPE_CACHE[pi.type_id].name,\n              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^\nKeyError: 1"}}
{"timestamp": "2025-05-21T13:51:10.194978", "level": "ERROR", "message": "Failed to build Pitch Interval cache", "module": "pitch_service", "function": "build_pitch_interval_cache", "line": 152, "exception": {"type": "KeyError", "message": "1", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 142, in build_pitch_interval_cache\n    type_name=self.PITCH_INTERVAL_TYPE_CACHE[pi.type_id].name,\n              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^\nKeyError: 1"}}
{"timestamp": "2025-05-22T13:39:30.525726", "level": "ERROR", "message": "Failed to update user info: 'AsyncSession' object has no attribute 'query'", "module": "auth_api", "function": "update_user_info", "line": 169, "exception": {"type": "AttributeError", "message": "'AsyncSession' object has no attribute 'query'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/api/v1/auth_api.py\", line 146, in update_user_info\n    existing_info = db.query(UserInfo).filter(UserInfo.user_id == current_user.id).first()\n                    ^^^^^^^^\nAttributeError: 'AsyncSession' object has no attribute 'query'"}}
{"timestamp": "2025-05-22T13:40:00.739870", "level": "ERROR", "message": "Failed to update user info: 'AsyncSession' object has no attribute 'query'", "module": "auth_api", "function": "update_user_info", "line": 169, "exception": {"type": "AttributeError", "message": "'AsyncSession' object has no attribute 'query'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/api/v1/auth_api.py\", line 146, in update_user_info\n    existing_info = db.query(UserInfo).filter(UserInfo.user_id == current_user.id).first()\n                    ^^^^^^^^\nAttributeError: 'AsyncSession' object has no attribute 'query'"}}
{"timestamp": "2025-05-22T13:41:34.988939", "level": "ERROR", "message": "Failed to update user info: type object 'UserInfo' has no attribute 'wechat_openid'", "module": "auth_api", "function": "update_user_info", "line": 170, "exception": {"type": "AttributeError", "message": "type object 'UserInfo' has no attribute 'wechat_openid'", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/api/v1/auth_api.py\", line 147, in update_user_info\n    result = await db.execute(select(UserInfo).where(UserInfo.wechat_openid == current_user.id))\n                                                     ^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: type object 'UserInfo' has no attribute 'wechat_openid'"}}
{"timestamp": "2025-05-22T14:01:13.350086", "level": "ERROR", "message": "Failed to create VIP order: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: '1747922473208' ('str' object cannot be interpreted as an integer)\n[SQL: INSERT INTO vip_order (trade_no, user_id, vip_id, prepay_id, is_paid, paid_date, paid_amount, is_return, return_date, return_amount) VALUES ($1::BIGINT, $2::INTEGER, $3::INTEGER, $4::VARCHAR, $5::BOOLEAN, $6::TIMESTAMP WITHOUT TIME ZONE, $7::BIGINT, $8::BOOLEAN, $9::TIMESTAMP WITHOUT TIME ZONE, $10::BIGINT) RETURNING vip_order.id, vip_order.created_at, vip_order.updated_at]\n[parameters: ('1747922473208', 1, 2, None, False, None, 100, False, None, None)]\n(Background on this error at: https://sqlalche.me/e/20/dbapi)", "module": "order_service", "function": "create_vip_order", "line": 56, "exception": {"type": "DBAPIError", "message": "(sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: '1747922473208' ('str' object cannot be interpreted as an integer)\n[SQL: INSERT INTO vip_order (trade_no, user_id, vip_id, prepay_id, is_paid, paid_date, paid_amount, is_return, return_date, return_amount) VALUES ($1::BIGINT, $2::INTEGER, $3::INTEGER, $4::VARCHAR, $5::BOOLEAN, $6::TIMESTAMP WITHOUT TIME ZONE, $7::BIGINT, $8::BOOLEAN, $9::TIMESTAMP WITHOUT TIME ZONE, $10::BIGINT) RETURNING vip_order.id, vip_order.created_at, vip_order.updated_at]\n[parameters: ('1747922473208', 1, 2, None, False, None, 100, False, None, None)]\n(Background on this error at: https://sqlalche.me/e/20/dbapi)", "traceback": "Traceback (most recent call last):\n  File \"asyncpg/protocol/prepared_stmt.pyx\", line 175, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg\n  File \"asyncpg/protocol/codecs/base.pyx\", line 227, in asyncpg.protocol.protocol.Codec.encode\n  File \"asyncpg/protocol/codecs/base.pyx\", line 129, in asyncpg.protocol.protocol.Codec.encode_scalar\n  File \"asyncpg/pgproto/./codecs/int.pyx\", line 105, in asyncpg.pgproto.pgproto.int8_encode\nTypeError: 'str' object cannot be interpreted as an integer\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 557, in _prepare_and_execute\n    self._rows = await prepared_stmt.fetch(*parameters)\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/asyncpg/prepared_stmt.py\", line 176, in fetch\n    data = await self.__bind_execute(args, 0, timeout)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/asyncpg/prepared_stmt.py\", line 267, in __bind_execute\n    data, status, _ = await self.__do_execute(\n                      ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/asyncpg/prepared_stmt.py\", line 256, in __do_execute\n    return await executor(protocol)\n           ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"asyncpg/protocol/protocol.pyx\", line 185, in bind_execute\n  File \"asyncpg/protocol/prepared_stmt.pyx\", line 204, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg\nasyncpg.exceptions.DataError: invalid input for query argument $1: '1747922473208' ('str' object cannot be interpreted as an integer)\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1969, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 922, in do_execute\n    cursor.execute(statement, parameters)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 591, in execute\n    self._adapt_connection.await_(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 125, in await_only\n    return current.driver.switch(awaitable)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 185, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 569, in _prepare_and_execute\n    self._handle_exception(error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 520, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 808, in _handle_exception\n    raise translated_error from error\nsqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: '1747922473208' ('str' object cannot be interpreted as an integer)\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 50, in create_vip_order\n    await db.commit()\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/ext/asyncio/session.py\", line 1011, in commit\n    await greenlet_spawn(self.sync_session.commit)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 192, in greenlet_spawn\n    result = context.switch(value)\n             ^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1969, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1256, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1231, in _prepare_impl\n    self.session.flush()\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4312, in flush\n    self._flush(objects)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4447, in _flush\n    with util.safe_reraise():\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4408, in _flush\n    flush_context.execute()\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1226, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1416, in execute\n    return meth(\n           ^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 516, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1639, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1848, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1988, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2343, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1969, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 922, in do_execute\n    cursor.execute(statement, parameters)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 591, in execute\n    self._adapt_connection.await_(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 125, in await_only\n    return current.driver.switch(awaitable)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 185, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 569, in _prepare_and_execute\n    self._handle_exception(error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 520, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 808, in _handle_exception\n    raise translated_error from error\nsqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: '1747922473208' ('str' object cannot be interpreted as an integer)\n[SQL: INSERT INTO vip_order (trade_no, user_id, vip_id, prepay_id, is_paid, paid_date, paid_amount, is_return, return_date, return_amount) VALUES ($1::BIGINT, $2::INTEGER, $3::INTEGER, $4::VARCHAR, $5::BOOLEAN, $6::TIMESTAMP WITHOUT TIME ZONE, $7::BIGINT, $8::BOOLEAN, $9::TIMESTAMP WITHOUT TIME ZONE, $10::BIGINT) RETURNING vip_order.id, vip_order.created_at, vip_order.updated_at]\n[parameters: ('1747922473208', 1, 2, None, False, None, 100, False, None, None)]\n(Background on this error at: https://sqlalche.me/e/20/dbapi)"}}
{"timestamp": "2025-05-22T14:08:25.412168", "level": "ERROR", "message": "Request failed", "module": "logging", "function": "dispatch", "line": 57, "exception": {"type": "ResponseValidationError", "message": "1 validation errors:\n  {'type': 'list_type', 'loc': ('response', 'questions'), 'msg': 'Input should be a valid list', 'input': <coroutine object PitchService.generate_interval_exam_concordance at 0x78c1649e8940>, 'url': 'https://errors.pydantic.dev/2.10/v/list_type'}\n", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/anyio/streams/memory.py\", line 98, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/anyio/streams/memory.py\", line 93, in receive_nowait\n    raise WouldBlock\nanyio.WouldBlock\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/base.py\", line 78, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/anyio/streams/memory.py\", line 118, in receive\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/middleware/logging.py\", line 34, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/base.py\", line 84, in call_next\n    raise app_exc\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/base.py\", line 70, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 79, in __call__\n    raise exc\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 68, in __call__\n    await self.app(scope, receive, sender)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py\", line 20, in __call__\n    raise e\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py\", line 17, in __call__\n    await self.app(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/routing.py\", line 718, in __call__\n    await route.handle(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/routing.py\", line 276, in handle\n    await self.app(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/routing.py\", line 66, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/routing.py\", line 292, in app\n    content = await serialize_response(\n              ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/routing.py\", line 155, in serialize_response\n    raise ResponseValidationError(\nfastapi.exceptions.ResponseValidationError: 1 validation errors:\n  {'type': 'list_type', 'loc': ('response', 'questions'), 'msg': 'Input should be a valid list', 'input': <coroutine object PitchService.generate_interval_exam_concordance at 0x78c1649e8940>, 'url': 'https://errors.pydantic.dev/2.10/v/list_type'}\n"}, "request_id": "cfd6ff5c-dfbe-4ba9-b4fa-05f07e1b990a", "path": "/api/v1/piano/pitch/interval/exam", "method": "POST"}
{"timestamp": "2025-05-22T14:08:27.443315", "level": "ERROR", "message": "Request failed", "module": "logging", "function": "dispatch", "line": 57, "exception": {"type": "ResponseValidationError", "message": "1 validation errors:\n  {'type': 'list_type', 'loc': ('response', 'questions'), 'msg': 'Input should be a valid list', 'input': <coroutine object PitchService.generate_interval_exam_quality at 0x78c1649e9840>, 'url': 'https://errors.pydantic.dev/2.10/v/list_type'}\n", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/anyio/streams/memory.py\", line 98, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/anyio/streams/memory.py\", line 93, in receive_nowait\n    raise WouldBlock\nanyio.WouldBlock\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/base.py\", line 78, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/anyio/streams/memory.py\", line 118, in receive\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/middleware/logging.py\", line 34, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/base.py\", line 84, in call_next\n    raise app_exc\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/base.py\", line 70, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 79, in __call__\n    raise exc\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 68, in __call__\n    await self.app(scope, receive, sender)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py\", line 20, in __call__\n    raise e\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py\", line 17, in __call__\n    await self.app(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/routing.py\", line 718, in __call__\n    await route.handle(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/routing.py\", line 276, in handle\n    await self.app(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/routing.py\", line 66, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/routing.py\", line 292, in app\n    content = await serialize_response(\n              ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/routing.py\", line 155, in serialize_response\n    raise ResponseValidationError(\nfastapi.exceptions.ResponseValidationError: 1 validation errors:\n  {'type': 'list_type', 'loc': ('response', 'questions'), 'msg': 'Input should be a valid list', 'input': <coroutine object PitchService.generate_interval_exam_quality at 0x78c1649e9840>, 'url': 'https://errors.pydantic.dev/2.10/v/list_type'}\n"}, "request_id": "56df541e-f9fc-47dd-a7dd-ec1e9b4e0e67", "path": "/api/v1/piano/pitch/interval/exam", "method": "POST"}
{"timestamp": "2025-05-22T14:08:30.396548", "level": "ERROR", "message": "Request failed", "module": "logging", "function": "dispatch", "line": 57, "exception": {"type": "ResponseValidationError", "message": "1 validation errors:\n  {'type': 'list_type', 'loc': ('response', 'questions'), 'msg': 'Input should be a valid list', 'input': <coroutine object PitchService.generate_interval_exam_pitch at 0x78c1649e99c0>, 'url': 'https://errors.pydantic.dev/2.10/v/list_type'}\n", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/anyio/streams/memory.py\", line 98, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/anyio/streams/memory.py\", line 93, in receive_nowait\n    raise WouldBlock\nanyio.WouldBlock\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/base.py\", line 78, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/anyio/streams/memory.py\", line 118, in receive\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/middleware/logging.py\", line 34, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/base.py\", line 84, in call_next\n    raise app_exc\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/base.py\", line 70, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 79, in __call__\n    raise exc\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 68, in __call__\n    await self.app(scope, receive, sender)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py\", line 20, in __call__\n    raise e\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py\", line 17, in __call__\n    await self.app(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/routing.py\", line 718, in __call__\n    await route.handle(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/routing.py\", line 276, in handle\n    await self.app(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/routing.py\", line 66, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/routing.py\", line 292, in app\n    content = await serialize_response(\n              ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/routing.py\", line 155, in serialize_response\n    raise ResponseValidationError(\nfastapi.exceptions.ResponseValidationError: 1 validation errors:\n  {'type': 'list_type', 'loc': ('response', 'questions'), 'msg': 'Input should be a valid list', 'input': <coroutine object PitchService.generate_interval_exam_pitch at 0x78c1649e99c0>, 'url': 'https://errors.pydantic.dev/2.10/v/list_type'}\n"}, "request_id": "7e028d31-6cc9-4c4a-89bf-137653f3cae5", "path": "/api/v1/piano/pitch/interval/exam", "method": "POST"}
{"timestamp": "2025-05-22T14:08:34.285721", "level": "ERROR", "message": "Request failed", "module": "logging", "function": "dispatch", "line": 57, "exception": {"type": "ResponseValidationError", "message": "1 validation errors:\n  {'type': 'list_type', 'loc': ('response', 'questions'), 'msg': 'Input should be a valid list', 'input': <coroutine object PitchService.generate_interval_exam_concordance at 0x78c1649e9b40>, 'url': 'https://errors.pydantic.dev/2.10/v/list_type'}\n", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/anyio/streams/memory.py\", line 98, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/anyio/streams/memory.py\", line 93, in receive_nowait\n    raise WouldBlock\nanyio.WouldBlock\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/base.py\", line 78, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/anyio/streams/memory.py\", line 118, in receive\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/middleware/logging.py\", line 34, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/base.py\", line 84, in call_next\n    raise app_exc\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/base.py\", line 70, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 79, in __call__\n    raise exc\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 68, in __call__\n    await self.app(scope, receive, sender)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py\", line 20, in __call__\n    raise e\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py\", line 17, in __call__\n    await self.app(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/routing.py\", line 718, in __call__\n    await route.handle(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/routing.py\", line 276, in handle\n    await self.app(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/routing.py\", line 66, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/routing.py\", line 292, in app\n    content = await serialize_response(\n              ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/routing.py\", line 155, in serialize_response\n    raise ResponseValidationError(\nfastapi.exceptions.ResponseValidationError: 1 validation errors:\n  {'type': 'list_type', 'loc': ('response', 'questions'), 'msg': 'Input should be a valid list', 'input': <coroutine object PitchService.generate_interval_exam_concordance at 0x78c1649e9b40>, 'url': 'https://errors.pydantic.dev/2.10/v/list_type'}\n"}, "request_id": "e0bb440a-0c99-489b-bab4-2e8ab8ad5e2d", "path": "/api/v1/piano/pitch/interval/exam", "method": "POST"}
{"timestamp": "2025-05-22T14:08:42.365975", "level": "ERROR", "message": "Request failed", "module": "logging", "function": "dispatch", "line": 57, "exception": {"type": "ResponseValidationError", "message": "1 validation errors:\n  {'type': 'list_type', 'loc': ('response', 'questions'), 'msg': 'Input should be a valid list', 'input': <coroutine object PitchService.generate_chord_exam_first at 0x78c1649e2140>, 'url': 'https://errors.pydantic.dev/2.10/v/list_type'}\n", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/anyio/streams/memory.py\", line 98, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/anyio/streams/memory.py\", line 93, in receive_nowait\n    raise WouldBlock\nanyio.WouldBlock\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/base.py\", line 78, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/anyio/streams/memory.py\", line 118, in receive\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/middleware/logging.py\", line 34, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/base.py\", line 84, in call_next\n    raise app_exc\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/base.py\", line 70, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 79, in __call__\n    raise exc\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 68, in __call__\n    await self.app(scope, receive, sender)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py\", line 20, in __call__\n    raise e\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py\", line 17, in __call__\n    await self.app(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/routing.py\", line 718, in __call__\n    await route.handle(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/routing.py\", line 276, in handle\n    await self.app(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/routing.py\", line 66, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/routing.py\", line 292, in app\n    content = await serialize_response(\n              ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/routing.py\", line 155, in serialize_response\n    raise ResponseValidationError(\nfastapi.exceptions.ResponseValidationError: 1 validation errors:\n  {'type': 'list_type', 'loc': ('response', 'questions'), 'msg': 'Input should be a valid list', 'input': <coroutine object PitchService.generate_chord_exam_first at 0x78c1649e2140>, 'url': 'https://errors.pydantic.dev/2.10/v/list_type'}\n"}, "request_id": "199895ee-5cda-4049-af1d-0c0b01fb8213", "path": "/api/v1/piano/pitch/chord/exam", "method": "POST"}
{"timestamp": "2025-05-22T14:10:04.102715", "level": "ERROR", "message": "Request failed", "module": "logging", "function": "dispatch", "line": 57, "exception": {"type": "ResponseValidationError", "message": "2 validation errors:\n  {'type': 'list_type', 'loc': ('response', 'interval', 'questions'), 'msg': 'Input should be a valid list', 'input': <coroutine object PitchService.generate_interval_exam_concordance at 0x78c14b8d47c0>, 'url': 'https://errors.pydantic.dev/2.10/v/list_type'}\n  {'type': 'list_type', 'loc': ('response', 'chord', 'questions'), 'msg': 'Input should be a valid list', 'input': <coroutine object PitchService.generate_chord_exam_first at 0x78c1649e0f60>, 'url': 'https://errors.pydantic.dev/2.10/v/list_type'}\n", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/anyio/streams/memory.py\", line 98, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/anyio/streams/memory.py\", line 93, in receive_nowait\n    raise WouldBlock\nanyio.WouldBlock\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/base.py\", line 78, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/anyio/streams/memory.py\", line 118, in receive\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/middleware/logging.py\", line 34, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/base.py\", line 84, in call_next\n    raise app_exc\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/base.py\", line 70, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 79, in __call__\n    raise exc\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 68, in __call__\n    await self.app(scope, receive, sender)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py\", line 20, in __call__\n    raise e\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py\", line 17, in __call__\n    await self.app(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/routing.py\", line 718, in __call__\n    await route.handle(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/routing.py\", line 276, in handle\n    await self.app(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/routing.py\", line 66, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/routing.py\", line 292, in app\n    content = await serialize_response(\n              ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/routing.py\", line 155, in serialize_response\n    raise ResponseValidationError(\nfastapi.exceptions.ResponseValidationError: 2 validation errors:\n  {'type': 'list_type', 'loc': ('response', 'interval', 'questions'), 'msg': 'Input should be a valid list', 'input': <coroutine object PitchService.generate_interval_exam_concordance at 0x78c14b8d47c0>, 'url': 'https://errors.pydantic.dev/2.10/v/list_type'}\n  {'type': 'list_type', 'loc': ('response', 'chord', 'questions'), 'msg': 'Input should be a valid list', 'input': <coroutine object PitchService.generate_chord_exam_first at 0x78c1649e0f60>, 'url': 'https://errors.pydantic.dev/2.10/v/list_type'}\n"}, "request_id": "67a255dd-11e3-4926-af95-49caf555503a", "path": "/api/v1/exam", "method": "POST"}
{"timestamp": "2025-05-22T14:10:16.117970", "level": "ERROR", "message": "Error in get_all_pitchgroups: 'PitchGroup' object has no attribute 'pitch_pairs'\nTraceback: Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/api/v1/piano_pitch_api.py\", line 192, in get_all_pitchgroups\n    pitch_groups = [\n                   ^\n  File \"/home/yu/gitdev/shengyibaodian/app/api/v1/piano_pitch_api.py\", line 193, in <listcomp>\n    replace(pg, pitches=[p for p in pg.pitch_pairs if not p.isBlackKey()], count=len([p for p in pg.pitch_pairs if not p.isBlackKey()]))\n                                    ^^^^^^^^^^^^^^\nAttributeError: 'PitchGroup' object has no attribute 'pitch_pairs'\n", "module": "piano_pitch_api", "function": "get_all_pitchgroups", "line": 201}
{"timestamp": "2025-05-22T14:10:53.295734", "level": "ERROR", "message": "Failed to create WeChat payment: can only concatenate str (not \"NoneType\") to str", "module": "order_service", "function": "create_wechat_payment", "line": 115, "exception": {"type": "TypeError", "message": "can only concatenate str (not \"NoneType\") to str", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 107, in create_wechat_payment\n    \"package\": \"prepay_id=\"+resp.get(\"prepay_id\"),\n               ~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~\nTypeError: can only concatenate str (not \"NoneType\") to str"}}
{"timestamp": "2025-05-22T14:11:11.145415", "level": "ERROR", "message": "Failed to get user info: cannot unpack non-iterable User object", "module": "auth_api", "function": "get_user_info", "line": 231, "exception": {"type": "TypeError", "message": "cannot unpack non-iterable User object", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/api/v1/auth_api.py\", line 197, in get_user_info\n    user, user_info = result\n    ^^^^^^^^^^^^^^^\nTypeError: cannot unpack non-iterable User object"}}
{"timestamp": "2025-05-22T14:13:22.594388", "level": "ERROR", "message": "Failed to get user info: cannot unpack non-iterable User object", "module": "auth_api", "function": "get_user_info", "line": 231, "exception": {"type": "TypeError", "message": "cannot unpack non-iterable User object", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/api/v1/auth_api.py\", line 197, in get_user_info\n    user, user_info = result\n    ^^^^^^^^^^^^^^^\nTypeError: cannot unpack non-iterable User object"}}
{"timestamp": "2025-05-22T14:17:33.876025", "level": "ERROR", "message": "Request failed", "module": "logging", "function": "dispatch", "line": 57, "exception": {"type": "ResponseValidationError", "message": "1 validation errors:\n  {'type': 'list_type', 'loc': ('response', 'questions'), 'msg': 'Input should be a valid list', 'input': <coroutine object PitchService.generate_interval_exam_quality at 0x741131860940>, 'url': 'https://errors.pydantic.dev/2.10/v/list_type'}\n", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/anyio/streams/memory.py\", line 98, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/anyio/streams/memory.py\", line 93, in receive_nowait\n    raise WouldBlock\nanyio.WouldBlock\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/base.py\", line 78, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/anyio/streams/memory.py\", line 118, in receive\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/middleware/logging.py\", line 34, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/base.py\", line 84, in call_next\n    raise app_exc\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/base.py\", line 70, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 79, in __call__\n    raise exc\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 68, in __call__\n    await self.app(scope, receive, sender)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py\", line 20, in __call__\n    raise e\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py\", line 17, in __call__\n    await self.app(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/routing.py\", line 718, in __call__\n    await route.handle(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/routing.py\", line 276, in handle\n    await self.app(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/routing.py\", line 66, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/routing.py\", line 292, in app\n    content = await serialize_response(\n              ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/routing.py\", line 155, in serialize_response\n    raise ResponseValidationError(\nfastapi.exceptions.ResponseValidationError: 1 validation errors:\n  {'type': 'list_type', 'loc': ('response', 'questions'), 'msg': 'Input should be a valid list', 'input': <coroutine object PitchService.generate_interval_exam_quality at 0x741131860940>, 'url': 'https://errors.pydantic.dev/2.10/v/list_type'}\n"}, "request_id": "f4cbc270-3a54-4442-8865-cb5bde265cf2", "path": "/api/v1/piano/pitch/interval/exam", "method": "POST"}
{"timestamp": "2025-05-22T14:20:13.531461", "level": "ERROR", "message": "Request failed", "module": "logging", "function": "dispatch", "line": 57, "exception": {"type": "ResponseValidationError", "message": "1 validation errors:\n  {'type': 'list_type', 'loc': ('response', 'questions'), 'msg': 'Input should be a valid list', 'input': <coroutine object PitchService.generate_chord_exam_first at 0x7ada595297a0>, 'url': 'https://errors.pydantic.dev/2.10/v/list_type'}\n", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/anyio/streams/memory.py\", line 98, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/anyio/streams/memory.py\", line 93, in receive_nowait\n    raise WouldBlock\nanyio.WouldBlock\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/base.py\", line 78, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/anyio/streams/memory.py\", line 118, in receive\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/middleware/logging.py\", line 34, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/base.py\", line 84, in call_next\n    raise app_exc\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/base.py\", line 70, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 79, in __call__\n    raise exc\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 68, in __call__\n    await self.app(scope, receive, sender)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py\", line 20, in __call__\n    raise e\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py\", line 17, in __call__\n    await self.app(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/routing.py\", line 718, in __call__\n    await route.handle(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/routing.py\", line 276, in handle\n    await self.app(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/routing.py\", line 66, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/routing.py\", line 292, in app\n    content = await serialize_response(\n              ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/routing.py\", line 155, in serialize_response\n    raise ResponseValidationError(\nfastapi.exceptions.ResponseValidationError: 1 validation errors:\n  {'type': 'list_type', 'loc': ('response', 'questions'), 'msg': 'Input should be a valid list', 'input': <coroutine object PitchService.generate_chord_exam_first at 0x7ada595297a0>, 'url': 'https://errors.pydantic.dev/2.10/v/list_type'}\n"}, "request_id": "81bd6717-8ba9-4219-b08b-5505b6985e0d", "path": "/api/v1/piano/pitch/chord/exam", "method": "POST"}
{"timestamp": "2025-05-25T03:16:31.824572", "level": "ERROR", "message": "Request failed", "module": "logging", "function": "dispatch", "line": 57, "exception": {"type": "ValidationError", "message": "2 validation errors for OpenAPI\ncomponents.schemas.PitchIntervalExamResponse.Schema.examples\n  Input should be a valid list [type=list_type, input_value={'correct_number': 0, 'ex...}}}], 'wrong_number': 0}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.10/v/list_type\ncomponents.schemas.PitchIntervalExamResponse.Reference.$ref\n  Field required [type=missing, input_value={'examples': {'correct_nu...onse', 'type': 'object'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.10/v/missing", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/base.py\", line 78, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/anyio/streams/memory.py\", line 98, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/anyio/streams/memory.py\", line 91, in receive_nowait\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/middleware/logging.py\", line 34, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/base.py\", line 84, in call_next\n    raise app_exc\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/base.py\", line 70, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 79, in __call__\n    raise exc\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 68, in __call__\n    await self.app(scope, receive, sender)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py\", line 20, in __call__\n    raise e\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py\", line 17, in __call__\n    await self.app(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/routing.py\", line 718, in __call__\n    await route.handle(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/routing.py\", line 276, in handle\n    await self.app(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/routing.py\", line 66, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/applications.py\", line 1061, in openapi\n    return JSONResponse(self.openapi())\n                        ^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/applications.py\", line 1033, in openapi\n    self.openapi_schema = get_openapi(\n                          ^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/openapi/utils.py\", line 530, in get_openapi\n    return jsonable_encoder(OpenAPI(**output), by_alias=True, exclude_none=True)  # type: ignore\n                            ^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\n                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\npydantic_core._pydantic_core.ValidationError: 2 validation errors for OpenAPI\ncomponents.schemas.PitchIntervalExamResponse.Schema.examples\n  Input should be a valid list [type=list_type, input_value={'correct_number': 0, 'ex...}}}], 'wrong_number': 0}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.10/v/list_type\ncomponents.schemas.PitchIntervalExamResponse.Reference.$ref\n  Field required [type=missing, input_value={'examples': {'correct_nu...onse', 'type': 'object'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.10/v/missing"}, "request_id": "c29e141a-22a2-43eb-9402-1ca7a09cff50", "path": "/api/v1/openapi.json", "method": "GET"}
{"timestamp": "2025-05-26T06:12:08.112892", "level": "ERROR", "message": "Failed to query create_vip_order for user 1: 1 validation error for OrderServiceResponse\ncount\n  Input should be a valid integer [type=int_type, input_value=<built-in method count of...bject at 0x70385f646f40>, input_type=builtin_function_or_method]\n    For further information visit https://errors.pydantic.dev/2.10/v/int_type\nTraceback: Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/api/v1/order_api.py\", line 269, in get_vip_orders\n    return OrderServiceResponse(\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\n                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\npydantic_core._pydantic_core.ValidationError: 1 validation error for OrderServiceResponse\ncount\n  Input should be a valid integer [type=int_type, input_value=<built-in method count of...bject at 0x70385f646f40>, input_type=builtin_function_or_method]\n    For further information visit https://errors.pydantic.dev/2.10/v/int_type\n", "module": "order_api", "function": "get_vip_orders", "line": 277}
{"timestamp": "2025-05-26T06:12:19.689956", "level": "ERROR", "message": "Failed to query create_vip_order for user 1: 1 validation error for OrderServiceResponse\ncount\n  Input should be a valid integer [type=int_type, input_value=<built-in method count of...bject at 0x70385d2072c0>, input_type=builtin_function_or_method]\n    For further information visit https://errors.pydantic.dev/2.10/v/int_type\nTraceback: Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/api/v1/order_api.py\", line 269, in get_vip_orders\n    return OrderServiceResponse(\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\n                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\npydantic_core._pydantic_core.ValidationError: 1 validation error for OrderServiceResponse\ncount\n  Input should be a valid integer [type=int_type, input_value=<built-in method count of...bject at 0x70385d2072c0>, input_type=builtin_function_or_method]\n    For further information visit https://errors.pydantic.dev/2.10/v/int_type\n", "module": "order_api", "function": "get_vip_orders", "line": 277}
{"timestamp": "2025-05-26T06:13:03.153154", "level": "ERROR", "message": "Failed to query create_vip_order for user 1: 1 validation error for OrderServiceResponse\ncount\n  Input should be a valid integer [type=int_type, input_value=<built-in method count of...bject at 0x7a796e63b6c0>, input_type=builtin_function_or_method]\n    For further information visit https://errors.pydantic.dev/2.10/v/int_type\nTraceback: Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/api/v1/order_api.py\", line 269, in get_vip_orders\n    return OrderServiceResponse(\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/pydantic/main.py\", line 214, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\n                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\npydantic_core._pydantic_core.ValidationError: 1 validation error for OrderServiceResponse\ncount\n  Input should be a valid integer [type=int_type, input_value=<built-in method count of...bject at 0x7a796e63b6c0>, input_type=builtin_function_or_method]\n    For further information visit https://errors.pydantic.dev/2.10/v/int_type\n", "module": "order_api", "function": "get_vip_orders", "line": 277}
{"timestamp": "2025-05-26T06:18:37.589631", "level": "ERROR", "message": "Failed to get VIP orders: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: datetime.datetime(1970, 1, 15, 9, 23, 43... (can't subtract offset-naive and offset-aware datetimes)\n[SQL: SELECT vip_order.id, vip_order.trade_no, vip_order.user_id, vip_order.vip_id, vip_order.prepay_id, vip_order.is_paid, vip_order.paid_date, vip_order.paid_amount, vip_order.is_return, vip_order.return_date, vip_order.return_amount, vip_order.created_at, vip_order.updated_at \nFROM vip_order \nWHERE vip_order.user_id = $1::INTEGER AND vip_order.is_paid = false AND vip_order.paid_date >= $2::TIMESTAMP WITHOUT TIME ZONE]\n[parameters: (1, datetime.datetime(1970, 1, 15, 9, 23, 43, tzinfo=TzInfo(UTC)))]\n(Background on this error at: https://sqlalche.me/e/20/dbapi)", "module": "order_service", "function": "get_vip_orders", "line": 315, "exception": {"type": "DBAPIError", "message": "(sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: datetime.datetime(1970, 1, 15, 9, 23, 43... (can't subtract offset-naive and offset-aware datetimes)\n[SQL: SELECT vip_order.id, vip_order.trade_no, vip_order.user_id, vip_order.vip_id, vip_order.prepay_id, vip_order.is_paid, vip_order.paid_date, vip_order.paid_amount, vip_order.is_return, vip_order.return_date, vip_order.return_amount, vip_order.created_at, vip_order.updated_at \nFROM vip_order \nWHERE vip_order.user_id = $1::INTEGER AND vip_order.is_paid = false AND vip_order.paid_date >= $2::TIMESTAMP WITHOUT TIME ZONE]\n[parameters: (1, datetime.datetime(1970, 1, 15, 9, 23, 43, tzinfo=TzInfo(UTC)))]\n(Background on this error at: https://sqlalche.me/e/20/dbapi)", "traceback": "Traceback (most recent call last):\n  File \"asyncpg/protocol/prepared_stmt.pyx\", line 175, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg\n  File \"asyncpg/protocol/codecs/base.pyx\", line 227, in asyncpg.protocol.protocol.Codec.encode\n  File \"asyncpg/protocol/codecs/base.pyx\", line 129, in asyncpg.protocol.protocol.Codec.encode_scalar\n  File \"asyncpg/pgproto/./codecs/datetime.pyx\", line 152, in asyncpg.pgproto.pgproto.timestamp_encode\nTypeError: can't subtract offset-naive and offset-aware datetimes\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 557, in _prepare_and_execute\n    self._rows = await prepared_stmt.fetch(*parameters)\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/asyncpg/prepared_stmt.py\", line 176, in fetch\n    data = await self.__bind_execute(args, 0, timeout)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/asyncpg/prepared_stmt.py\", line 267, in __bind_execute\n    data, status, _ = await self.__do_execute(\n                      ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/asyncpg/prepared_stmt.py\", line 256, in __do_execute\n    return await executor(protocol)\n           ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"asyncpg/protocol/protocol.pyx\", line 185, in bind_execute\n  File \"asyncpg/protocol/prepared_stmt.pyx\", line 204, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg\nasyncpg.exceptions.DataError: invalid input for query argument $2: datetime.datetime(1970, 1, 15, 9, 23, 43... (can't subtract offset-naive and offset-aware datetimes)\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1969, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 922, in do_execute\n    cursor.execute(statement, parameters)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 591, in execute\n    self._adapt_connection.await_(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 125, in await_only\n    return current.driver.switch(awaitable)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 185, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 569, in _prepare_and_execute\n    self._handle_exception(error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 520, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 808, in _handle_exception\n    raise translated_error from error\nsqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: datetime.datetime(1970, 1, 15, 9, 23, 43... (can't subtract offset-naive and offset-aware datetimes)\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 309, in get_vip_orders\n    result = await db.execute(query)\n             ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/ext/asyncio/session.py\", line 455, in execute\n    result = await greenlet_spawn(\n             ^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.throw(*sys.exc_info())\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2308, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2190, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1416, in execute\n    return meth(\n           ^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 516, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1639, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1848, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1988, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2343, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1969, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 922, in do_execute\n    cursor.execute(statement, parameters)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 591, in execute\n    self._adapt_connection.await_(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 125, in await_only\n    return current.driver.switch(awaitable)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 185, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 569, in _prepare_and_execute\n    self._handle_exception(error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 520, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 808, in _handle_exception\n    raise translated_error from error\nsqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: datetime.datetime(1970, 1, 15, 9, 23, 43... (can't subtract offset-naive and offset-aware datetimes)\n[SQL: SELECT vip_order.id, vip_order.trade_no, vip_order.user_id, vip_order.vip_id, vip_order.prepay_id, vip_order.is_paid, vip_order.paid_date, vip_order.paid_amount, vip_order.is_return, vip_order.return_date, vip_order.return_amount, vip_order.created_at, vip_order.updated_at \nFROM vip_order \nWHERE vip_order.user_id = $1::INTEGER AND vip_order.is_paid = false AND vip_order.paid_date >= $2::TIMESTAMP WITHOUT TIME ZONE]\n[parameters: (1, datetime.datetime(1970, 1, 15, 9, 23, 43, tzinfo=TzInfo(UTC)))]\n(Background on this error at: https://sqlalche.me/e/20/dbapi)"}}
{"timestamp": "2025-05-26T06:20:14.475799", "level": "ERROR", "message": "Failed to get VIP orders: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: datetime.datetime(2025, 5, 26, 6, 20, tz... (can't subtract offset-naive and offset-aware datetimes)\n[SQL: SELECT vip_order.id, vip_order.trade_no, vip_order.user_id, vip_order.vip_id, vip_order.prepay_id, vip_order.is_paid, vip_order.paid_date, vip_order.paid_amount, vip_order.is_return, vip_order.return_date, vip_order.return_amount, vip_order.created_at, vip_order.updated_at \nFROM vip_order \nWHERE vip_order.user_id = $1::INTEGER AND vip_order.is_paid = false AND vip_order.paid_date >= $2::TIMESTAMP WITHOUT TIME ZONE]\n[parameters: (1, datetime.datetime(2025, 5, 26, 6, 20, tzinfo=TzInfo(UTC)))]\n(Background on this error at: https://sqlalche.me/e/20/dbapi)", "module": "order_service", "function": "get_vip_orders", "line": 315, "exception": {"type": "DBAPIError", "message": "(sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: datetime.datetime(2025, 5, 26, 6, 20, tz... (can't subtract offset-naive and offset-aware datetimes)\n[SQL: SELECT vip_order.id, vip_order.trade_no, vip_order.user_id, vip_order.vip_id, vip_order.prepay_id, vip_order.is_paid, vip_order.paid_date, vip_order.paid_amount, vip_order.is_return, vip_order.return_date, vip_order.return_amount, vip_order.created_at, vip_order.updated_at \nFROM vip_order \nWHERE vip_order.user_id = $1::INTEGER AND vip_order.is_paid = false AND vip_order.paid_date >= $2::TIMESTAMP WITHOUT TIME ZONE]\n[parameters: (1, datetime.datetime(2025, 5, 26, 6, 20, tzinfo=TzInfo(UTC)))]\n(Background on this error at: https://sqlalche.me/e/20/dbapi)", "traceback": "Traceback (most recent call last):\n  File \"asyncpg/protocol/prepared_stmt.pyx\", line 175, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg\n  File \"asyncpg/protocol/codecs/base.pyx\", line 227, in asyncpg.protocol.protocol.Codec.encode\n  File \"asyncpg/protocol/codecs/base.pyx\", line 129, in asyncpg.protocol.protocol.Codec.encode_scalar\n  File \"asyncpg/pgproto/./codecs/datetime.pyx\", line 152, in asyncpg.pgproto.pgproto.timestamp_encode\nTypeError: can't subtract offset-naive and offset-aware datetimes\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 557, in _prepare_and_execute\n    self._rows = await prepared_stmt.fetch(*parameters)\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/asyncpg/prepared_stmt.py\", line 176, in fetch\n    data = await self.__bind_execute(args, 0, timeout)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/asyncpg/prepared_stmt.py\", line 267, in __bind_execute\n    data, status, _ = await self.__do_execute(\n                      ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/asyncpg/prepared_stmt.py\", line 256, in __do_execute\n    return await executor(protocol)\n           ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"asyncpg/protocol/protocol.pyx\", line 185, in bind_execute\n  File \"asyncpg/protocol/prepared_stmt.pyx\", line 204, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg\nasyncpg.exceptions.DataError: invalid input for query argument $2: datetime.datetime(2025, 5, 26, 6, 20, tz... (can't subtract offset-naive and offset-aware datetimes)\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1969, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 922, in do_execute\n    cursor.execute(statement, parameters)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 591, in execute\n    self._adapt_connection.await_(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 125, in await_only\n    return current.driver.switch(awaitable)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 185, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 569, in _prepare_and_execute\n    self._handle_exception(error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 520, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 808, in _handle_exception\n    raise translated_error from error\nsqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: datetime.datetime(2025, 5, 26, 6, 20, tz... (can't subtract offset-naive and offset-aware datetimes)\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 309, in get_vip_orders\n    result = await db.execute(query)\n             ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/ext/asyncio/session.py\", line 455, in execute\n    result = await greenlet_spawn(\n             ^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.throw(*sys.exc_info())\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2308, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2190, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1416, in execute\n    return meth(\n           ^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 516, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1639, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1848, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1988, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2343, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1969, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 922, in do_execute\n    cursor.execute(statement, parameters)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 591, in execute\n    self._adapt_connection.await_(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 125, in await_only\n    return current.driver.switch(awaitable)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 185, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 569, in _prepare_and_execute\n    self._handle_exception(error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 520, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 808, in _handle_exception\n    raise translated_error from error\nsqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: datetime.datetime(2025, 5, 26, 6, 20, tz... (can't subtract offset-naive and offset-aware datetimes)\n[SQL: SELECT vip_order.id, vip_order.trade_no, vip_order.user_id, vip_order.vip_id, vip_order.prepay_id, vip_order.is_paid, vip_order.paid_date, vip_order.paid_amount, vip_order.is_return, vip_order.return_date, vip_order.return_amount, vip_order.created_at, vip_order.updated_at \nFROM vip_order \nWHERE vip_order.user_id = $1::INTEGER AND vip_order.is_paid = false AND vip_order.paid_date >= $2::TIMESTAMP WITHOUT TIME ZONE]\n[parameters: (1, datetime.datetime(2025, 5, 26, 6, 20, tzinfo=TzInfo(UTC)))]\n(Background on this error at: https://sqlalche.me/e/20/dbapi)"}}
{"timestamp": "2025-05-26T06:22:23.996702", "level": "ERROR", "message": "Failed to get VIP orders: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: datetime.datetime(2025, 5, 25, 2, 33, 20... (can't subtract offset-naive and offset-aware datetimes)\n[SQL: SELECT vip_order.id, vip_order.trade_no, vip_order.user_id, vip_order.vip_id, vip_order.prepay_id, vip_order.is_paid, vip_order.paid_date, vip_order.paid_amount, vip_order.is_return, vip_order.return_date, vip_order.return_amount, vip_order.created_at, vip_order.updated_at \nFROM vip_order \nWHERE vip_order.user_id = $1::INTEGER AND vip_order.is_paid = false AND vip_order.paid_date >= $2::TIMESTAMP WITHOUT TIME ZONE]\n[parameters: (1, datetime.datetime(2025, 5, 25, 2, 33, 20, tzinfo=TzInfo(UTC)))]\n(Background on this error at: https://sqlalche.me/e/20/dbapi)", "module": "order_service", "function": "get_vip_orders", "line": 315, "exception": {"type": "DBAPIError", "message": "(sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: datetime.datetime(2025, 5, 25, 2, 33, 20... (can't subtract offset-naive and offset-aware datetimes)\n[SQL: SELECT vip_order.id, vip_order.trade_no, vip_order.user_id, vip_order.vip_id, vip_order.prepay_id, vip_order.is_paid, vip_order.paid_date, vip_order.paid_amount, vip_order.is_return, vip_order.return_date, vip_order.return_amount, vip_order.created_at, vip_order.updated_at \nFROM vip_order \nWHERE vip_order.user_id = $1::INTEGER AND vip_order.is_paid = false AND vip_order.paid_date >= $2::TIMESTAMP WITHOUT TIME ZONE]\n[parameters: (1, datetime.datetime(2025, 5, 25, 2, 33, 20, tzinfo=TzInfo(UTC)))]\n(Background on this error at: https://sqlalche.me/e/20/dbapi)", "traceback": "Traceback (most recent call last):\n  File \"asyncpg/protocol/prepared_stmt.pyx\", line 175, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg\n  File \"asyncpg/protocol/codecs/base.pyx\", line 227, in asyncpg.protocol.protocol.Codec.encode\n  File \"asyncpg/protocol/codecs/base.pyx\", line 129, in asyncpg.protocol.protocol.Codec.encode_scalar\n  File \"asyncpg/pgproto/./codecs/datetime.pyx\", line 152, in asyncpg.pgproto.pgproto.timestamp_encode\nTypeError: can't subtract offset-naive and offset-aware datetimes\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 557, in _prepare_and_execute\n    self._rows = await prepared_stmt.fetch(*parameters)\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/asyncpg/prepared_stmt.py\", line 176, in fetch\n    data = await self.__bind_execute(args, 0, timeout)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/asyncpg/prepared_stmt.py\", line 267, in __bind_execute\n    data, status, _ = await self.__do_execute(\n                      ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/asyncpg/prepared_stmt.py\", line 256, in __do_execute\n    return await executor(protocol)\n           ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"asyncpg/protocol/protocol.pyx\", line 185, in bind_execute\n  File \"asyncpg/protocol/prepared_stmt.pyx\", line 204, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg\nasyncpg.exceptions.DataError: invalid input for query argument $2: datetime.datetime(2025, 5, 25, 2, 33, 20... (can't subtract offset-naive and offset-aware datetimes)\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1969, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 922, in do_execute\n    cursor.execute(statement, parameters)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 591, in execute\n    self._adapt_connection.await_(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 125, in await_only\n    return current.driver.switch(awaitable)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 185, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 569, in _prepare_and_execute\n    self._handle_exception(error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 520, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 808, in _handle_exception\n    raise translated_error from error\nsqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: datetime.datetime(2025, 5, 25, 2, 33, 20... (can't subtract offset-naive and offset-aware datetimes)\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 309, in get_vip_orders\n    result = await db.execute(query)\n             ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/ext/asyncio/session.py\", line 455, in execute\n    result = await greenlet_spawn(\n             ^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.throw(*sys.exc_info())\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2308, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2190, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1416, in execute\n    return meth(\n           ^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 516, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1639, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1848, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1988, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2343, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1969, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 922, in do_execute\n    cursor.execute(statement, parameters)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 591, in execute\n    self._adapt_connection.await_(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 125, in await_only\n    return current.driver.switch(awaitable)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 185, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 569, in _prepare_and_execute\n    self._handle_exception(error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 520, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 808, in _handle_exception\n    raise translated_error from error\nsqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: datetime.datetime(2025, 5, 25, 2, 33, 20... (can't subtract offset-naive and offset-aware datetimes)\n[SQL: SELECT vip_order.id, vip_order.trade_no, vip_order.user_id, vip_order.vip_id, vip_order.prepay_id, vip_order.is_paid, vip_order.paid_date, vip_order.paid_amount, vip_order.is_return, vip_order.return_date, vip_order.return_amount, vip_order.created_at, vip_order.updated_at \nFROM vip_order \nWHERE vip_order.user_id = $1::INTEGER AND vip_order.is_paid = false AND vip_order.paid_date >= $2::TIMESTAMP WITHOUT TIME ZONE]\n[parameters: (1, datetime.datetime(2025, 5, 25, 2, 33, 20, tzinfo=TzInfo(UTC)))]\n(Background on this error at: https://sqlalche.me/e/20/dbapi)"}}
{"timestamp": "2025-05-26T06:22:31.629104", "level": "ERROR", "message": "Failed to get VIP orders: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: datetime.datetime(2025, 5, 23, 22, 46, 4... (can't subtract offset-naive and offset-aware datetimes)\n[SQL: SELECT vip_order.id, vip_order.trade_no, vip_order.user_id, vip_order.vip_id, vip_order.prepay_id, vip_order.is_paid, vip_order.paid_date, vip_order.paid_amount, vip_order.is_return, vip_order.return_date, vip_order.return_amount, vip_order.created_at, vip_order.updated_at \nFROM vip_order \nWHERE vip_order.user_id = $1::INTEGER AND vip_order.is_paid = false AND vip_order.paid_date >= $2::TIMESTAMP WITHOUT TIME ZONE]\n[parameters: (1, datetime.datetime(2025, 5, 23, 22, 46, 40, tzinfo=TzInfo(UTC)))]\n(Background on this error at: https://sqlalche.me/e/20/dbapi)", "module": "order_service", "function": "get_vip_orders", "line": 315, "exception": {"type": "DBAPIError", "message": "(sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: datetime.datetime(2025, 5, 23, 22, 46, 4... (can't subtract offset-naive and offset-aware datetimes)\n[SQL: SELECT vip_order.id, vip_order.trade_no, vip_order.user_id, vip_order.vip_id, vip_order.prepay_id, vip_order.is_paid, vip_order.paid_date, vip_order.paid_amount, vip_order.is_return, vip_order.return_date, vip_order.return_amount, vip_order.created_at, vip_order.updated_at \nFROM vip_order \nWHERE vip_order.user_id = $1::INTEGER AND vip_order.is_paid = false AND vip_order.paid_date >= $2::TIMESTAMP WITHOUT TIME ZONE]\n[parameters: (1, datetime.datetime(2025, 5, 23, 22, 46, 40, tzinfo=TzInfo(UTC)))]\n(Background on this error at: https://sqlalche.me/e/20/dbapi)", "traceback": "Traceback (most recent call last):\n  File \"asyncpg/protocol/prepared_stmt.pyx\", line 175, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg\n  File \"asyncpg/protocol/codecs/base.pyx\", line 227, in asyncpg.protocol.protocol.Codec.encode\n  File \"asyncpg/protocol/codecs/base.pyx\", line 129, in asyncpg.protocol.protocol.Codec.encode_scalar\n  File \"asyncpg/pgproto/./codecs/datetime.pyx\", line 152, in asyncpg.pgproto.pgproto.timestamp_encode\nTypeError: can't subtract offset-naive and offset-aware datetimes\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 557, in _prepare_and_execute\n    self._rows = await prepared_stmt.fetch(*parameters)\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/asyncpg/prepared_stmt.py\", line 176, in fetch\n    data = await self.__bind_execute(args, 0, timeout)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/asyncpg/prepared_stmt.py\", line 267, in __bind_execute\n    data, status, _ = await self.__do_execute(\n                      ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/asyncpg/prepared_stmt.py\", line 256, in __do_execute\n    return await executor(protocol)\n           ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"asyncpg/protocol/protocol.pyx\", line 185, in bind_execute\n  File \"asyncpg/protocol/prepared_stmt.pyx\", line 204, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg\nasyncpg.exceptions.DataError: invalid input for query argument $2: datetime.datetime(2025, 5, 23, 22, 46, 4... (can't subtract offset-naive and offset-aware datetimes)\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1969, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 922, in do_execute\n    cursor.execute(statement, parameters)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 591, in execute\n    self._adapt_connection.await_(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 125, in await_only\n    return current.driver.switch(awaitable)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 185, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 569, in _prepare_and_execute\n    self._handle_exception(error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 520, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 808, in _handle_exception\n    raise translated_error from error\nsqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: datetime.datetime(2025, 5, 23, 22, 46, 4... (can't subtract offset-naive and offset-aware datetimes)\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 309, in get_vip_orders\n    result = await db.execute(query)\n             ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/ext/asyncio/session.py\", line 455, in execute\n    result = await greenlet_spawn(\n             ^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.throw(*sys.exc_info())\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2308, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2190, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1416, in execute\n    return meth(\n           ^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 516, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1639, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1848, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1988, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2343, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1969, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 922, in do_execute\n    cursor.execute(statement, parameters)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 591, in execute\n    self._adapt_connection.await_(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 125, in await_only\n    return current.driver.switch(awaitable)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 185, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 569, in _prepare_and_execute\n    self._handle_exception(error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 520, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 808, in _handle_exception\n    raise translated_error from error\nsqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: datetime.datetime(2025, 5, 23, 22, 46, 4... (can't subtract offset-naive and offset-aware datetimes)\n[SQL: SELECT vip_order.id, vip_order.trade_no, vip_order.user_id, vip_order.vip_id, vip_order.prepay_id, vip_order.is_paid, vip_order.paid_date, vip_order.paid_amount, vip_order.is_return, vip_order.return_date, vip_order.return_amount, vip_order.created_at, vip_order.updated_at \nFROM vip_order \nWHERE vip_order.user_id = $1::INTEGER AND vip_order.is_paid = false AND vip_order.paid_date >= $2::TIMESTAMP WITHOUT TIME ZONE]\n[parameters: (1, datetime.datetime(2025, 5, 23, 22, 46, 40, tzinfo=TzInfo(UTC)))]\n(Background on this error at: https://sqlalche.me/e/20/dbapi)"}}
{"timestamp": "2025-05-26T06:22:37.019389", "level": "ERROR", "message": "Failed to get VIP orders: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: datetime.datetime(2025, 5, 12, 9, 0, tzi... (can't subtract offset-naive and offset-aware datetimes)\n[SQL: SELECT vip_order.id, vip_order.trade_no, vip_order.user_id, vip_order.vip_id, vip_order.prepay_id, vip_order.is_paid, vip_order.paid_date, vip_order.paid_amount, vip_order.is_return, vip_order.return_date, vip_order.return_amount, vip_order.created_at, vip_order.updated_at \nFROM vip_order \nWHERE vip_order.user_id = $1::INTEGER AND vip_order.is_paid = false AND vip_order.paid_date >= $2::TIMESTAMP WITHOUT TIME ZONE]\n[parameters: (1, datetime.datetime(2025, 5, 12, 9, 0, tzinfo=TzInfo(UTC)))]\n(Background on this error at: https://sqlalche.me/e/20/dbapi)", "module": "order_service", "function": "get_vip_orders", "line": 315, "exception": {"type": "DBAPIError", "message": "(sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: datetime.datetime(2025, 5, 12, 9, 0, tzi... (can't subtract offset-naive and offset-aware datetimes)\n[SQL: SELECT vip_order.id, vip_order.trade_no, vip_order.user_id, vip_order.vip_id, vip_order.prepay_id, vip_order.is_paid, vip_order.paid_date, vip_order.paid_amount, vip_order.is_return, vip_order.return_date, vip_order.return_amount, vip_order.created_at, vip_order.updated_at \nFROM vip_order \nWHERE vip_order.user_id = $1::INTEGER AND vip_order.is_paid = false AND vip_order.paid_date >= $2::TIMESTAMP WITHOUT TIME ZONE]\n[parameters: (1, datetime.datetime(2025, 5, 12, 9, 0, tzinfo=TzInfo(UTC)))]\n(Background on this error at: https://sqlalche.me/e/20/dbapi)", "traceback": "Traceback (most recent call last):\n  File \"asyncpg/protocol/prepared_stmt.pyx\", line 175, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg\n  File \"asyncpg/protocol/codecs/base.pyx\", line 227, in asyncpg.protocol.protocol.Codec.encode\n  File \"asyncpg/protocol/codecs/base.pyx\", line 129, in asyncpg.protocol.protocol.Codec.encode_scalar\n  File \"asyncpg/pgproto/./codecs/datetime.pyx\", line 152, in asyncpg.pgproto.pgproto.timestamp_encode\nTypeError: can't subtract offset-naive and offset-aware datetimes\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 557, in _prepare_and_execute\n    self._rows = await prepared_stmt.fetch(*parameters)\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/asyncpg/prepared_stmt.py\", line 176, in fetch\n    data = await self.__bind_execute(args, 0, timeout)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/asyncpg/prepared_stmt.py\", line 267, in __bind_execute\n    data, status, _ = await self.__do_execute(\n                      ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/asyncpg/prepared_stmt.py\", line 256, in __do_execute\n    return await executor(protocol)\n           ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"asyncpg/protocol/protocol.pyx\", line 185, in bind_execute\n  File \"asyncpg/protocol/prepared_stmt.pyx\", line 204, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg\nasyncpg.exceptions.DataError: invalid input for query argument $2: datetime.datetime(2025, 5, 12, 9, 0, tzi... (can't subtract offset-naive and offset-aware datetimes)\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1969, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 922, in do_execute\n    cursor.execute(statement, parameters)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 591, in execute\n    self._adapt_connection.await_(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 125, in await_only\n    return current.driver.switch(awaitable)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 185, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 569, in _prepare_and_execute\n    self._handle_exception(error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 520, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 808, in _handle_exception\n    raise translated_error from error\nsqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: datetime.datetime(2025, 5, 12, 9, 0, tzi... (can't subtract offset-naive and offset-aware datetimes)\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 309, in get_vip_orders\n    result = await db.execute(query)\n             ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/ext/asyncio/session.py\", line 455, in execute\n    result = await greenlet_spawn(\n             ^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.throw(*sys.exc_info())\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2308, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2190, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1416, in execute\n    return meth(\n           ^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 516, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1639, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1848, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1988, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2343, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1969, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 922, in do_execute\n    cursor.execute(statement, parameters)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 591, in execute\n    self._adapt_connection.await_(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 125, in await_only\n    return current.driver.switch(awaitable)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 185, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 569, in _prepare_and_execute\n    self._handle_exception(error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 520, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 808, in _handle_exception\n    raise translated_error from error\nsqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: datetime.datetime(2025, 5, 12, 9, 0, tzi... (can't subtract offset-naive and offset-aware datetimes)\n[SQL: SELECT vip_order.id, vip_order.trade_no, vip_order.user_id, vip_order.vip_id, vip_order.prepay_id, vip_order.is_paid, vip_order.paid_date, vip_order.paid_amount, vip_order.is_return, vip_order.return_date, vip_order.return_amount, vip_order.created_at, vip_order.updated_at \nFROM vip_order \nWHERE vip_order.user_id = $1::INTEGER AND vip_order.is_paid = false AND vip_order.paid_date >= $2::TIMESTAMP WITHOUT TIME ZONE]\n[parameters: (1, datetime.datetime(2025, 5, 12, 9, 0, tzinfo=TzInfo(UTC)))]\n(Background on this error at: https://sqlalche.me/e/20/dbapi)"}}
{"timestamp": "2025-05-26T06:22:41.090650", "level": "ERROR", "message": "Failed to get VIP orders: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: datetime.datetime(1970, 1, 21, 5, 17, 20... (can't subtract offset-naive and offset-aware datetimes)\n[SQL: SELECT vip_order.id, vip_order.trade_no, vip_order.user_id, vip_order.vip_id, vip_order.prepay_id, vip_order.is_paid, vip_order.paid_date, vip_order.paid_amount, vip_order.is_return, vip_order.return_date, vip_order.return_amount, vip_order.created_at, vip_order.updated_at \nFROM vip_order \nWHERE vip_order.user_id = $1::INTEGER AND vip_order.is_paid = false AND vip_order.paid_date >= $2::TIMESTAMP WITHOUT TIME ZONE]\n[parameters: (1, datetime.datetime(1970, 1, 21, 5, 17, 20, tzinfo=TzInfo(UTC)))]\n(Background on this error at: https://sqlalche.me/e/20/dbapi)", "module": "order_service", "function": "get_vip_orders", "line": 315, "exception": {"type": "DBAPIError", "message": "(sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: datetime.datetime(1970, 1, 21, 5, 17, 20... (can't subtract offset-naive and offset-aware datetimes)\n[SQL: SELECT vip_order.id, vip_order.trade_no, vip_order.user_id, vip_order.vip_id, vip_order.prepay_id, vip_order.is_paid, vip_order.paid_date, vip_order.paid_amount, vip_order.is_return, vip_order.return_date, vip_order.return_amount, vip_order.created_at, vip_order.updated_at \nFROM vip_order \nWHERE vip_order.user_id = $1::INTEGER AND vip_order.is_paid = false AND vip_order.paid_date >= $2::TIMESTAMP WITHOUT TIME ZONE]\n[parameters: (1, datetime.datetime(1970, 1, 21, 5, 17, 20, tzinfo=TzInfo(UTC)))]\n(Background on this error at: https://sqlalche.me/e/20/dbapi)", "traceback": "Traceback (most recent call last):\n  File \"asyncpg/protocol/prepared_stmt.pyx\", line 175, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg\n  File \"asyncpg/protocol/codecs/base.pyx\", line 227, in asyncpg.protocol.protocol.Codec.encode\n  File \"asyncpg/protocol/codecs/base.pyx\", line 129, in asyncpg.protocol.protocol.Codec.encode_scalar\n  File \"asyncpg/pgproto/./codecs/datetime.pyx\", line 152, in asyncpg.pgproto.pgproto.timestamp_encode\nTypeError: can't subtract offset-naive and offset-aware datetimes\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 557, in _prepare_and_execute\n    self._rows = await prepared_stmt.fetch(*parameters)\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/asyncpg/prepared_stmt.py\", line 176, in fetch\n    data = await self.__bind_execute(args, 0, timeout)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/asyncpg/prepared_stmt.py\", line 267, in __bind_execute\n    data, status, _ = await self.__do_execute(\n                      ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/asyncpg/prepared_stmt.py\", line 256, in __do_execute\n    return await executor(protocol)\n           ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"asyncpg/protocol/protocol.pyx\", line 185, in bind_execute\n  File \"asyncpg/protocol/prepared_stmt.pyx\", line 204, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg\nasyncpg.exceptions.DataError: invalid input for query argument $2: datetime.datetime(1970, 1, 21, 5, 17, 20... (can't subtract offset-naive and offset-aware datetimes)\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1969, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 922, in do_execute\n    cursor.execute(statement, parameters)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 591, in execute\n    self._adapt_connection.await_(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 125, in await_only\n    return current.driver.switch(awaitable)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 185, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 569, in _prepare_and_execute\n    self._handle_exception(error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 520, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 808, in _handle_exception\n    raise translated_error from error\nsqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: datetime.datetime(1970, 1, 21, 5, 17, 20... (can't subtract offset-naive and offset-aware datetimes)\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 309, in get_vip_orders\n    result = await db.execute(query)\n             ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/ext/asyncio/session.py\", line 455, in execute\n    result = await greenlet_spawn(\n             ^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.throw(*sys.exc_info())\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2308, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2190, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1416, in execute\n    return meth(\n           ^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 516, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1639, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1848, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1988, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2343, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1969, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 922, in do_execute\n    cursor.execute(statement, parameters)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 591, in execute\n    self._adapt_connection.await_(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 125, in await_only\n    return current.driver.switch(awaitable)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 185, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 569, in _prepare_and_execute\n    self._handle_exception(error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 520, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 808, in _handle_exception\n    raise translated_error from error\nsqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: datetime.datetime(1970, 1, 21, 5, 17, 20... (can't subtract offset-naive and offset-aware datetimes)\n[SQL: SELECT vip_order.id, vip_order.trade_no, vip_order.user_id, vip_order.vip_id, vip_order.prepay_id, vip_order.is_paid, vip_order.paid_date, vip_order.paid_amount, vip_order.is_return, vip_order.return_date, vip_order.return_amount, vip_order.created_at, vip_order.updated_at \nFROM vip_order \nWHERE vip_order.user_id = $1::INTEGER AND vip_order.is_paid = false AND vip_order.paid_date >= $2::TIMESTAMP WITHOUT TIME ZONE]\n[parameters: (1, datetime.datetime(1970, 1, 21, 5, 17, 20, tzinfo=TzInfo(UTC)))]\n(Background on this error at: https://sqlalche.me/e/20/dbapi)"}}
{"timestamp": "2025-05-26T06:22:55.843892", "level": "ERROR", "message": "Failed to get VIP orders: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: datetime.datetime(1970, 1, 21, 5, 17, 20... (can't subtract offset-naive and offset-aware datetimes)\n[SQL: SELECT vip_order.id, vip_order.trade_no, vip_order.user_id, vip_order.vip_id, vip_order.prepay_id, vip_order.is_paid, vip_order.paid_date, vip_order.paid_amount, vip_order.is_return, vip_order.return_date, vip_order.return_amount, vip_order.created_at, vip_order.updated_at \nFROM vip_order \nWHERE vip_order.user_id = $1::INTEGER AND vip_order.is_paid = true AND vip_order.paid_date >= $2::TIMESTAMP WITHOUT TIME ZONE]\n[parameters: (1, datetime.datetime(1970, 1, 21, 5, 17, 20, tzinfo=TzInfo(UTC)))]\n(Background on this error at: https://sqlalche.me/e/20/dbapi)", "module": "order_service", "function": "get_vip_orders", "line": 315, "exception": {"type": "DBAPIError", "message": "(sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: datetime.datetime(1970, 1, 21, 5, 17, 20... (can't subtract offset-naive and offset-aware datetimes)\n[SQL: SELECT vip_order.id, vip_order.trade_no, vip_order.user_id, vip_order.vip_id, vip_order.prepay_id, vip_order.is_paid, vip_order.paid_date, vip_order.paid_amount, vip_order.is_return, vip_order.return_date, vip_order.return_amount, vip_order.created_at, vip_order.updated_at \nFROM vip_order \nWHERE vip_order.user_id = $1::INTEGER AND vip_order.is_paid = true AND vip_order.paid_date >= $2::TIMESTAMP WITHOUT TIME ZONE]\n[parameters: (1, datetime.datetime(1970, 1, 21, 5, 17, 20, tzinfo=TzInfo(UTC)))]\n(Background on this error at: https://sqlalche.me/e/20/dbapi)", "traceback": "Traceback (most recent call last):\n  File \"asyncpg/protocol/prepared_stmt.pyx\", line 175, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg\n  File \"asyncpg/protocol/codecs/base.pyx\", line 227, in asyncpg.protocol.protocol.Codec.encode\n  File \"asyncpg/protocol/codecs/base.pyx\", line 129, in asyncpg.protocol.protocol.Codec.encode_scalar\n  File \"asyncpg/pgproto/./codecs/datetime.pyx\", line 152, in asyncpg.pgproto.pgproto.timestamp_encode\nTypeError: can't subtract offset-naive and offset-aware datetimes\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 557, in _prepare_and_execute\n    self._rows = await prepared_stmt.fetch(*parameters)\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/asyncpg/prepared_stmt.py\", line 176, in fetch\n    data = await self.__bind_execute(args, 0, timeout)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/asyncpg/prepared_stmt.py\", line 267, in __bind_execute\n    data, status, _ = await self.__do_execute(\n                      ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/asyncpg/prepared_stmt.py\", line 256, in __do_execute\n    return await executor(protocol)\n           ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"asyncpg/protocol/protocol.pyx\", line 185, in bind_execute\n  File \"asyncpg/protocol/prepared_stmt.pyx\", line 204, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg\nasyncpg.exceptions.DataError: invalid input for query argument $2: datetime.datetime(1970, 1, 21, 5, 17, 20... (can't subtract offset-naive and offset-aware datetimes)\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1969, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 922, in do_execute\n    cursor.execute(statement, parameters)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 591, in execute\n    self._adapt_connection.await_(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 125, in await_only\n    return current.driver.switch(awaitable)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 185, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 569, in _prepare_and_execute\n    self._handle_exception(error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 520, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 808, in _handle_exception\n    raise translated_error from error\nsqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: datetime.datetime(1970, 1, 21, 5, 17, 20... (can't subtract offset-naive and offset-aware datetimes)\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/order_service.py\", line 309, in get_vip_orders\n    result = await db.execute(query)\n             ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/ext/asyncio/session.py\", line 455, in execute\n    result = await greenlet_spawn(\n             ^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.throw(*sys.exc_info())\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2308, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2190, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1416, in execute\n    return meth(\n           ^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 516, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1639, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1848, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1988, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2343, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1969, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 922, in do_execute\n    cursor.execute(statement, parameters)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 591, in execute\n    self._adapt_connection.await_(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 125, in await_only\n    return current.driver.switch(awaitable)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 185, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 569, in _prepare_and_execute\n    self._handle_exception(error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 520, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 808, in _handle_exception\n    raise translated_error from error\nsqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: datetime.datetime(1970, 1, 21, 5, 17, 20... (can't subtract offset-naive and offset-aware datetimes)\n[SQL: SELECT vip_order.id, vip_order.trade_no, vip_order.user_id, vip_order.vip_id, vip_order.prepay_id, vip_order.is_paid, vip_order.paid_date, vip_order.paid_amount, vip_order.is_return, vip_order.return_date, vip_order.return_amount, vip_order.created_at, vip_order.updated_at \nFROM vip_order \nWHERE vip_order.user_id = $1::INTEGER AND vip_order.is_paid = true AND vip_order.paid_date >= $2::TIMESTAMP WITHOUT TIME ZONE]\n[parameters: (1, datetime.datetime(1970, 1, 21, 5, 17, 20, tzinfo=TzInfo(UTC)))]\n(Background on this error at: https://sqlalche.me/e/20/dbapi)"}}
