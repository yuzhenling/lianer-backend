{"timestamp": "2025-03-23T05:38:01.081761", "level": "ERROR", "message": "Error in get_all_pitches: 'coroutine' object is not iterable\nTraceback: Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/api/v1/piano_pitch_api.py\", line 38, in get_all_pitches\n    return [PitchResponse.model_validate(pitch) for pitch in pitches]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: 'coroutine' object is not iterable\n", "module": "piano_pitch_api", "function": "get_all_pitches", "line": 40}
{"timestamp": "2025-03-23T07:53:09.312284", "level": "ERROR", "message": "Failed to initialize application", "module": "main", "function": "lifespan", "line": 51, "exception": {"type": "ProgrammingError", "message": "(psycopg2.errors.UndefinedColumn) column pitch.url does not exist\nLINE 1: ...h.name AS pitch_name, pitch.alias AS pitch_alias, pitch.url ...\n                                                             ^\n\n[SQL: SELECT pitch.id AS pitch_id, pitch.pitch_number AS pitch_pitch_number, pitch.name AS pitch_name, pitch.alias AS pitch_alias, pitch.url AS pitch_url \nFROM pitch]\n(Background on this error at: https://sqlalche.me/e/20/f405)", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1969, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 922, in do_execute\n    cursor.execute(statement, parameters)\npsycopg2.errors.UndefinedColumn: column pitch.url does not exist\nLINE 1: ...h.name AS pitch_name, pitch.alias AS pitch_alias, pitch.url ...\n                                                             ^\n\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/main.py\", line 41, in lifespan\n    init_pitches(db)\n  File \"/home/yu/gitdev/shengyibaodian/app/db/init_data.py\", line 70, in init_pitches\n    pitches = db.query(Pitch).all()\n              ^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/query.py\", line 2693, in all\n    return self._iter().all()  # type: ignore\n           ^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/query.py\", line 2847, in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\n                                                  ^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2308, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2190, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1416, in execute\n    return meth(\n           ^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 516, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1639, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1848, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1988, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2343, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1969, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 922, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column pitch.url does not exist\nLINE 1: ...h.name AS pitch_name, pitch.alias AS pitch_alias, pitch.url ...\n                                                             ^\n\n[SQL: SELECT pitch.id AS pitch_id, pitch.pitch_number AS pitch_pitch_number, pitch.name AS pitch_name, pitch.alias AS pitch_alias, pitch.url AS pitch_url \nFROM pitch]\n(Background on this error at: https://sqlalche.me/e/20/f405)"}}
{"timestamp": "2025-03-23T07:55:14.759191", "level": "ERROR", "message": "Error in get_all_pitches: 1 validation error for PitchResponse\nfile_path\n  Field required [type=missing, input_value=<app.models.pitch.Pitch object at 0x70671b1c4550>, input_type=Pitch]\n    For further information visit https://errors.pydantic.dev/2.10/v/missing\nTraceback: Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/api/v1/piano_pitch_api.py\", line 38, in get_all_pitches\n    return [PitchResponse.model_validate(pitch) for pitch in pitches]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/api/v1/piano_pitch_api.py\", line 38, in <listcomp>\n    return [PitchResponse.model_validate(pitch) for pitch in pitches]\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/pydantic/main.py\", line 627, in model_validate\n    return cls.__pydantic_validator__.validate_python(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\npydantic_core._pydantic_core.ValidationError: 1 validation error for PitchResponse\nfile_path\n  Field required [type=missing, input_value=<app.models.pitch.Pitch object at 0x70671b1c4550>, input_type=Pitch]\n    For further information visit https://errors.pydantic.dev/2.10/v/missing\n", "module": "piano_pitch_api", "function": "get_all_pitches", "line": 40}
{"timestamp": "2025-03-23T09:18:02.879218", "level": "ERROR", "message": "Failed to load Pitch cache", "module": "pitch_service", "function": "get_pitch_by_name", "line": 64, "exception": {"type": "TypeError", "message": "argument of type 'NoneType' is not iterable", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 61, in get_pitch_by_name\n    filter_data = {k:v for k,v in self._pitch_cache.items() if name in v.name or name in v.alias}\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 61, in <dictcomp>\n    filter_data = {k:v for k,v in self._pitch_cache.items() if name in v.name or name in v.alias}\n                                                                                 ^^^^^^^^^^^^^^^\nTypeError: argument of type 'NoneType' is not iterable"}}
{"timestamp": "2025-03-23T09:18:02.879886", "level": "ERROR", "message": "Error in search_pitch_by_name with name=A0, alias=None: argument of type 'NoneType' is not iterable\nTraceback: Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/api/v1/piano_pitch_api.py\", line 86, in search_pitch_by_name\n    pitches = await pitch_service.get_pitch_by_name(name)\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 65, in get_pitch_by_name\n    raise e\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 61, in get_pitch_by_name\n    filter_data = {k:v for k,v in self._pitch_cache.items() if name in v.name or name in v.alias}\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 61, in <dictcomp>\n    filter_data = {k:v for k,v in self._pitch_cache.items() if name in v.name or name in v.alias}\n                                                                                 ^^^^^^^^^^^^^^^\nTypeError: argument of type 'NoneType' is not iterable\n", "module": "piano_pitch_api", "function": "search_pitch_by_name", "line": 98}
{"timestamp": "2025-03-23T09:18:40.718019", "level": "ERROR", "message": "Failed to load Pitch cache", "module": "pitch_service", "function": "get_pitch_by_name", "line": 64, "exception": {"type": "TypeError", "message": "argument of type 'NoneType' is not iterable", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 61, in get_pitch_by_name\n    filter_data = {k:v for k,v in self._pitch_cache.items() if name in v.name or name in v.alias}\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 61, in <dictcomp>\n    filter_data = {k:v for k,v in self._pitch_cache.items() if name in v.name or name in v.alias}\n                                                                                 ^^^^^^^^^^^^^^^\nTypeError: argument of type 'NoneType' is not iterable"}}
{"timestamp": "2025-03-23T09:18:40.729555", "level": "ERROR", "message": "Request failed", "module": "logging", "function": "dispatch", "line": 57, "exception": {"type": "NameError", "message": "name 'alias' is not defined", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/anyio/streams/memory.py\", line 98, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/anyio/streams/memory.py\", line 93, in receive_nowait\n    raise WouldBlock\nanyio.WouldBlock\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/base.py\", line 78, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/anyio/streams/memory.py\", line 118, in receive\n    raise EndOfStream\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/middleware/logging.py\", line 34, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/base.py\", line 84, in call_next\n    raise app_exc\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/base.py\", line 70, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 79, in __call__\n    raise exc\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 68, in __call__\n    await self.app(scope, receive, sender)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py\", line 20, in __call__\n    raise e\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py\", line 17, in __call__\n    await self.app(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/routing.py\", line 718, in __call__\n    await route.handle(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/routing.py\", line 276, in handle\n    await self.app(scope, receive, send)\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/starlette/routing.py\", line 66, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/routing.py\", line 274, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/dev/anaconda3/envs/shengyibaodian/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/api/v1/piano_pitch_api.py\", line 97, in search_pitch_by_name\n    logger.error(f\"Error in search_pitch_by_name with name={name}, alias={alias}: {str(e)}\\nTraceback: {traceback.format_exc()}\")\n                                                                          ^^^^^\nNameError: name 'alias' is not defined"}, "request_id": "b8f42a30-a7cc-44ff-9026-6ca1d0dd0d63", "path": "/api/v1/piano/pitch/name/A0", "method": "GET"}
{"timestamp": "2025-03-23T09:19:48.539056", "level": "ERROR", "message": "Failed to load Pitch cache", "module": "pitch_service", "function": "get_pitch_by_name", "line": 64, "exception": {"type": "TypeError", "message": "argument of type 'NoneType' is not iterable", "traceback": "Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 61, in get_pitch_by_name\n    filter_data = {k:v for k,v in self._pitch_cache.items() if name in v.name or name in v.alias}\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 61, in <dictcomp>\n    filter_data = {k:v for k,v in self._pitch_cache.items() if name in v.name or name in v.alias}\n                                                                                 ^^^^^^^^^^^^^^^\nTypeError: argument of type 'NoneType' is not iterable"}}
{"timestamp": "2025-03-23T09:19:48.539700", "level": "ERROR", "message": "Error in search_pitch_by_name with name=A0: argument of type 'NoneType' is not iterable\nTraceback: Traceback (most recent call last):\n  File \"/home/yu/gitdev/shengyibaodian/app/api/v1/piano_pitch_api.py\", line 85, in search_pitch_by_name\n    pitches = await pitch_service.get_pitch_by_name(name)\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 65, in get_pitch_by_name\n    raise e\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 61, in get_pitch_by_name\n    filter_data = {k:v for k,v in self._pitch_cache.items() if name in v.name or name in v.alias}\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yu/gitdev/shengyibaodian/app/services/pitch_service.py\", line 61, in <dictcomp>\n    filter_data = {k:v for k,v in self._pitch_cache.items() if name in v.name or name in v.alias}\n                                                                                 ^^^^^^^^^^^^^^^\nTypeError: argument of type 'NoneType' is not iterable\n", "module": "piano_pitch_api", "function": "search_pitch_by_name", "line": 97}
