sudo mkdir -p /opt/miniconda3
wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
   
sudo bash Miniconda3-latest-Linux-x86_64.sh -b -p /opt/miniconda3
   
sudo chmod -R 777 /opt/miniconda3
   /etc/profile.d/conda.sh << EOL
# >>> conda initialize >>>
# !! Contents within this block are managed by 'conda init' !!
__conda_setup="\$('/opt/miniconda3/bin/conda' 'shell.bash' 'hook' 2> /dev/null)"
if [ \$? -eq 0 ]; then
    eval "\$__conda_setup"
else
    if [ -f "/opt/miniconda3/etc/profile.d/conda.sh" ]; then
        . "/opt/miniconda3/etc/profile.d/conda.sh"
    else
        export PATH="/opt/miniconda3/bin:\$PATH"
    fi
fi
unset __conda_setup


   40  sudo vi /etc/profile.d/conda.sh
   41  sudo chmod +x /etc/profile.d/conda.sh 
   42  source /etc/profile.d/conda.sh 
   
   50  conda create -n sybd python=3.11
   51  conda activate sybd

   56  chmod -R 777 harbour/sybd/shengyibaodian/
   57  sudo chmod -R 777 harbour/sybd/shengyibaodian/
 
   59  cd harbour/


conda env export --no-builds > sybd.yml
scp sybd.yml yuzhenling@8.152.200.145:/home/yuzhenling/


conda env create -f sybd.yml -n yikao 
又崩错

sudo apt-get install libsndfile1 ffmpeg

pip install --use-pep517 -i https://pypi.tuna.tsinghua.edu.cn/simple aubio==0.4.9

拆分




sudo apt-get install -y \
    libsoxr-dev \
    libsndfile1-dev \
    libasound2-dev \
    portaudio19-dev \
    python3-pyaudio





sudo apt-get install zlib1g-dev


pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple


sudo apt-get install nginx supervisor


sudo apt install postgresql postgresql-contrib -y

sudo systemctl status postgresql

systemctl list-units | grep postgresql
sudo systemctl start postgresql@14-main.service
sudo systemctl enable postgresql@14-main.service  # 设置开机自启

sudo -u postgres psql
sudo -u postgres createuser --interactive  # 按提示输入用户名和权限
sudo -u postgres createdb shengyibaodian             # 创建数据库


 ps aux|grep postgres
 sudo netstat -tulnp | grep 5432


非必要远程访问：

    修改配置文件：
    bash

sudo nano /etc/postgresql/*/main/postgresql.conf

找到 listen_addresses 并改为：
ini

listen_addresses = '*'  # 或指定IP

修改客户端认证文件：
bash

sudo nano /etc/postgresql/*/main/pg_hba.conf

在文件末尾添加一行（允许所有IP通过密码访问）：
ini

host    all             all             0.0.0.0/0               md5

重启 PostgreSQL：
bash

sudo systemctl restart postgresql



sudo -u postgres psql -c "\password postgres"
Enter new password for user "postgres": 
Enter it again: 
(yikao) yuzhenling@iZ2ze1a6e219vcft1rsms7Z:/harbour/sybd/shengyibaodian$ sudo -u postgres psql -c "SELECT usename, passwd FROM pg_shadow WHERE usename = 'postgres';"
 usename  |                                                                passwd                                                                 
----------+---------------------------------------------------------------------------------------------------------------------------------------
 postgres | SCRAM-SHA-256$4096:l2xpDYjCoE9Y83IbCt9NTQ==$ERSIqhsRgZnsiv9X/gR5HoEKCDJKHqv+zoQsfvPVI8s=:uneuptgWSHk7qRx1OfIm6qhd1/v2MfUtXtGizUAClY0=
(1 row)

psql -U postgres -h 127.0.0.1 -W


python -m uvicorn main:app --host 0.0.0.0 --port 9443 --ssl-keyfile /harbour/sybd/shengyibaodian/etc/ssl/private/private.key --ssl-certfile /harbour/sybd/shengyibaodian/etc/ssl/certs/certificate.crt


阿里云控制台增加9443端口规则



/etc/systemd/system/yikao.service

[Unit]
Description=yikao app
After=network.target

[Service]
User=yuzhenling
Group=yuzhenling
WorkingDirectory=/harbour/sybd/shengyibaodian

# 使用conda环境中的Python和uvicorn
#Environment="PATH=/opt/miniconda3/conda/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
ExecStart=/opt/miniconda3/envs/yikao/bin/python -m uvicorn main:app --host 0.0.0.0 --port 9443 --ssl-keyfile /harbour/sybd/shengyibaodian/etc/ssl/private/private.key --ssl-certfile /harbour/sybd/shengyibaodian/etc/ssl/certs/certificate.crt

Restart=always
RestartSec=5
KillSignal=SIGINT
TimeoutStopSec=30

# 日志配置
StandardOutput=journal
StandardError=journal
SyslogIdentifier=yikao

[Install]
WantedBy=multi-user.target


# 重新加载配置
sudo systemctl daemon-reload

# 重启服务
sudo systemctl restart yikao

sudo systemctl status yikao

# 查看最新日志
sudo journalctl -u yikao -n 30 --no-pager


sudo systemctl show --property=User yikao.service


WECHATPAY2-SHA256-RSA2048 mchid="1711281977",nonce_str="OgSPMTVboijcEhrsd01X6jrsl6Flt7XG",signature="cr0KoDnBXXIOyoqIjN52NPDEVc6XjG+0V5NroAUAeYM7GNGaLHQyrtoLnb5+wCb2dwirZd4eVD2zlg7yjsL4CE7qMshKD4qMhASKOx2OpWiR2V58s9o/2EWmD8fjgg7/79P/ekoS5gg03zZeGAuZA9cpWWp7psyoCvBBn0kueiIZj8LLJ1qvrjyNw5+XW9abTSTQ7EiscShum8IiBybILCgfT2TfXizcMMYHdNGFAteIXPva5SBvcKfdOxv3BsKn3kqo/rce7HSQYT+TJ/giLrC/HZv/uxT91hNlPWt+B+BugTVxMNmUCcXL9ujKk/bcxWDxq8vtBsTUksrTi7G1Xg==",timestamp="1747635407",serial_no="5D7B5FCEE61F97EAD3726C3DD3766683344A501F"